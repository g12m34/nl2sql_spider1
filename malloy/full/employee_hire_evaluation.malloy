// Malloy semantic layer for: employee_hire_evaluation
// Full layer with ALL columns, primary keys, and bidirectional joins
// Database: /workspace/spider_db/spider/database/employee_hire_evaluation/employee_hire_evaluation.sqlite

// ============================================================
// BASE SOURCES (no joins - enables forward references)
// ============================================================

// employee
source: employee_base is duckdb.sql("""
  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/employee_hire_evaluation/employee_hire_evaluation.sqlite', 'employee')
""") extend {
  dimension:
    employee_i_d is Employee_ID
    name_val is `Name`

  primary_key: employee_i_d

  measure:
    row_count is count()
    total_employee_i_d is sum(employee_i_d)
    avg_employee_i_d is avg(employee_i_d)
    max_employee_i_d is max(employee_i_d)
    min_employee_i_d is min(employee_i_d)
    total_age is sum(Age)
    avg_age is avg(Age)
    max_age is max(Age)
    min_age is min(Age)
}

// shop
source: shop_base is duckdb.sql("""
  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/employee_hire_evaluation/employee_hire_evaluation.sqlite', 'shop')
""") extend {
  dimension:
    shop_i_d is Shop_ID
    name_val is `Name`

  primary_key: shop_i_d

  measure:
    row_count is count()
    total_shop_i_d is sum(shop_i_d)
    avg_shop_i_d is avg(shop_i_d)
    max_shop_i_d is max(shop_i_d)
    min_shop_i_d is min(shop_i_d)
    total_number_products is sum(Number_products)
    avg_number_products is avg(Number_products)
    max_number_products is max(Number_products)
    min_number_products is min(Number_products)
}

// hiring
source: hiring_base is duckdb.sql("""
  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/employee_hire_evaluation/employee_hire_evaluation.sqlite', 'hiring')
""") extend {
  dimension:
    shop_i_d is Shop_ID
    employee_i_d is Employee_ID

  primary_key: employee_i_d

  measure:
    row_count is count()
    total_shop_i_d is sum(shop_i_d)
    avg_shop_i_d is avg(shop_i_d)
    max_shop_i_d is max(shop_i_d)
    min_shop_i_d is min(shop_i_d)
    total_employee_i_d is sum(employee_i_d)
    avg_employee_i_d is avg(employee_i_d)
    max_employee_i_d is max(employee_i_d)
    min_employee_i_d is min(employee_i_d)
}

// evaluation
source: evaluation_base is duckdb.sql("""
  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/employee_hire_evaluation/employee_hire_evaluation.sqlite', 'evaluation')
""") extend {
  dimension:
    employee_i_d is Employee_ID

  primary_key: employee_i_d

  measure:
    row_count is count()
    total_bonus is sum(Bonus)
    avg_bonus is avg(Bonus)
    max_bonus is max(Bonus)
    min_bonus is min(Bonus)
}

// ============================================================
// FULL SOURCES (with joins - use these for queries)
// ============================================================

// employee (with joins)
source: employee is employee_base extend {
  join_many: hiring is hiring_base on employee_i_d = hiring.employee_i_d
  join_many: evaluation is evaluation_base on employee_i_d = evaluation.employee_i_d
}

// shop (with joins)
source: shop is shop_base extend {
  join_many: hiring is hiring_base on shop_i_d = hiring.shop_i_d
}

// hiring (with joins)
source: hiring is hiring_base extend {
  join_one: employee is employee_base on employee_i_d = employee.employee_i_d
  join_one: shop is shop_base on shop_i_d = shop.shop_i_d
}

// evaluation (with joins)
source: evaluation is evaluation_base extend {
  join_one: employee is employee_base on employee_i_d = employee.employee_i_d
}
