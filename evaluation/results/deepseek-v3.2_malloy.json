{
  "metadata": {
    "provider": "deepseek/deepseek-chat",
    "timestamp": "2026-01-11T17:20:16.868926",
    "total": 46,
    "correct": 30,
    "errors": 12,
    "accuracy": 0.6521739130434783,
    "evaluation_type": "malloy"
  },
  "results": [
    {
      "question_id": 0,
      "db_id": "game_1",
      "question": "What are the ids of all students who played video games and sports?",
      "gold_sql": "SELECT StuID FROM Sportsinfo INTERSECT SELECT StuID FROM Plays_games",
      "predicted_malloy": "run: student -> {\n  group_by: stu_id\n  aggregate: \n    video_game_count is count(plays_games.stu_id),\n    sports_count is count(sports_info.stu_id)\n} -> {\n  where: video_game_count > 0 and sports_count > 0\n  select: stu_id\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"StuID\" as \"stu_id\",\n     count(distinct (plays_games_0.\"StuID\")) as \"video_game_count\",\n     count(distinct (sports_info_0.\"StuID\")) as \"sports_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/game_1/game_1.sqlite', 'Student')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/game_1/game_1.sqlite', 'Plays_Games')\n  ) AS plays_games_0\n    ON (base.\"StuID\")=(plays_games_0.\"StuID\")\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/game_1/game_1.sqlite', 'SportsInfo')\n  ) AS sports_info_0\n    ON (base.\"StuID\")=(sports_info_0.\"StuID\")\n  GROUP BY 1\n)\nSELECT \n   base.\"stu_id\" as \"stu_id\"\nFROM __stage0 as base\nWHERE (base.\"video_game_count\">0)and(base.\"sports_count\">0)\n",
      "match": true,
      "error": null,
      "latency_ms": 3932.535409927368,
      "raw_response": "run: student -> {\n  group_by: stu_id\n  aggregate: \n    video_game_count is count(plays_games.stu_id),\n    sports_count is count(sports_info.stu_id)\n} -> {\n  where: video_game_count > 0 and sports_count > 0\n  select: stu_id\n}",
      "pred_row_count": 1,
      "gold_row_count": 1
    },
    {
      "question_id": 1,
      "db_id": "scholar",
      "question": "who published the most at chi",
      "gold_sql": "SELECT DISTINCT COUNT ( DISTINCT t2.paperid )  ,  t1.authorid FROM venue AS t3 JOIN paper AS t2 ON t3.venueid  =  t2.venueid JOIN writes AS t1 ON t1.paperid  =  t2.paperid WHERE t3.venuename  =  \"chi\" GROUP BY t1.authorid ORDER BY COUNT ( DISTINCT t2.paperid ) DESC;",
      "predicted_malloy": "run: author -> {\n  group_by: author_name\n  aggregate: chi_papers is count(writes.paper.paper_id) { where: writes.paper.venue.venue_name = 'chi' }\n} -> {\n  order_by: chi_papers desc\n  limit: 1\n  select: author_name\n}",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: Unknown field chi_papers in output space at line 5",
      "latency_ms": 3376.4488697052,
      "raw_response": "run: author -> {\n  group_by: author_name\n  aggregate: chi_papers is count(writes.paper.paper_id) { where: writes.paper.venue.venue_name = 'chi' }\n} -> {\n  order_by: chi_papers desc\n  limit: 1\n  select: author_name\n}"
    },
    {
      "question_id": 2,
      "db_id": "movie_1",
      "question": "What are the titles and directors of the movies whose star is greater than the average stars of the movies directed by James Cameron?",
      "gold_sql": "SELECT T2.title ,  T2.director FROM Rating AS T1 JOIN Movie AS T2 ON T1.mID  =  T2.mID WHERE T1.stars  >  (SELECT avg(T1.stars) FROM Rating AS T1 JOIN Movie AS T2 ON T1.mID  =  T2.mID WHERE T2.director  =  \"James Cameron\")",
      "predicted_malloy": "run: movie -> {\n  group_by: movie_title, directed_by\n  aggregate: \n    movie_avg_stars is avg(rating.star_rating)\n    james_cameron_avg is avg(movie_base.avg_year) {\n      where: movie_base.directed_by = 'James Cameron'\n    }\n} -> {\n  where: movie_avg_stars > james_cameron_avg\n  select: movie_title, directed_by\n}",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: Join path is required for this calculation; use `rating.star_rating.avg()` at line 4",
      "latency_ms": 4359.3292236328125,
      "raw_response": "```malloy\nrun: movie -> {\n  group_by: movie_title, directed_by\n  aggregate: \n    movie_avg_stars is avg(rating.star_rating)\n    james_cameron_avg is avg(movie_base.avg_year) {\n      where: movie_base.directed_by = 'James Cameron'\n    }\n} -> {\n  where: movie_avg_stars > james_cameron_avg\n  select: movie_title, directed_by\n}\n```"
    },
    {
      "question_id": 3,
      "db_id": "manufactory_1",
      "question": "Find the name of product that is produced by both companies Creative Labs and Sony.",
      "gold_sql": "SELECT T1.name FROM products AS T1 JOIN manufacturers AS T2 ON T1.Manufacturer  =  T2.code WHERE T2.name  =  'Creative Labs' INTERSECT SELECT T1.name FROM products AS T1 JOIN manufacturers AS T2 ON T1.Manufacturer  =  T2.code WHERE T2.name  =  'Sony'",
      "predicted_malloy": "run: products -> {\n  group_by: name\n  aggregate: \n    creative_labs_count is count(manufacturers.code) { where: manufacturers.name = 'Creative Labs' },\n    sony_count is count(manufacturers.code) { where: manufacturers.name = 'Sony' }\n} -> {\n  where: creative_labs_count > 0 and sony_count > 0\n  select: name\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"Name\" as \"name\",\n     count(distinct CASE WHEN (manufacturers_0.\"Name\")='Creative Labs' THEN (manufacturers_0.\"Code\") END) as \"creative_labs_count\",\n     count(distinct CASE WHEN (manufacturers_0.\"Name\")='Sony' THEN (manufacturers_0.\"Code\") END) as \"sony_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/manufactory_1/manufactory_1.sqlite', 'Products')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/manufactory_1/manufactory_1.sqlite', 'Manufacturers')\n  ) AS manufacturers_0\n    ON (base.\"Manufacturer\")=(manufacturers_0.\"Code\")\n  GROUP BY 1\n)\nSELECT \n   base.\"name\" as \"name\"\nFROM __stage0 as base\nWHERE (base.\"creative_labs_count\">0)and(base.\"sony_count\">0)\n",
      "match": true,
      "error": null,
      "latency_ms": 1255.180835723877,
      "raw_response": "```malloy\nrun: products -> {\n  group_by: name\n  aggregate: \n    creative_labs_count is count(manufacturers.code) { where: manufacturers.name = 'Creative Labs' },\n    sony_count is count(manufacturers.code) { where: manufacturers.name = 'Sony' }\n} -> {\n  where: creative_labs_count > 0 and sony_count > 0\n  select: name\n}\n```",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 4,
      "db_id": "ship_1",
      "question": "What are the ranks of captains that are both in the Cutter and Armed schooner classes?",
      "gold_sql": "SELECT rank FROM captain WHERE CLASS  =  'Cutter' INTERSECT SELECT rank FROM captain WHERE CLASS  =  'Armed schooner'",
      "predicted_malloy": "run: captain -> {\n  group_by: rank\n  aggregate: \n    cutter_count is count() { where: captain_class = 'Cutter' }\n    schooner_count is count() { where: captain_class = 'Armed schooner' }\n} -> {\n  where: cutter_count > 0 and schooner_count > 0\n  select: rank\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"Rank\" as \"rank\",\n     COUNT(CASE WHEN (base.\"Class\")='Cutter' THEN 1 END) as \"cutter_count\",\n     COUNT(CASE WHEN (base.\"Class\")='Armed schooner' THEN 1 END) as \"schooner_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/ship_1/ship_1.sqlite', 'captain')\n  ) as base\n  GROUP BY 1\n)\nSELECT \n   base.\"rank\" as \"rank\"\nFROM __stage0 as base\nWHERE (base.\"cutter_count\">0)and(base.\"schooner_count\">0)\n",
      "match": true,
      "error": null,
      "latency_ms": 3317.9574012756348,
      "raw_response": "run: captain -> {\n  group_by: rank\n  aggregate: \n    cutter_count is count() { where: captain_class = 'Cutter' }\n    schooner_count is count() { where: captain_class = 'Armed schooner' }\n} -> {\n  where: cutter_count > 0 and schooner_count > 0\n  select: rank\n}",
      "pred_row_count": 1,
      "gold_row_count": 1
    },
    {
      "question_id": 5,
      "db_id": "gas_company",
      "question": "Show all headquarters without a company in banking industry.",
      "gold_sql": "SELECT headquarters FROM company EXCEPT SELECT headquarters FROM company WHERE main_industry  =  'Banking'",
      "predicted_malloy": "run: company -> {\n  group_by: headquarters\n  aggregate: banking_count is count() { where: main_industry = 'Banking' }\n} -> {\n  where: banking_count = 0\n  select: headquarters\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"Headquarters\" as \"headquarters\",\n     COUNT(CASE WHEN (base.\"Main_Industry\")='Banking' THEN 1 END) as \"banking_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/gas_company/gas_company.sqlite', 'company')\n  ) as base\n  GROUP BY 1\n)\nSELECT \n   base.\"headquarters\" as \"headquarters\"\nFROM __stage0 as base\nWHERE base.\"banking_count\"=0\n",
      "match": true,
      "error": null,
      "latency_ms": 2487.5190258026123,
      "raw_response": "```malloy\nrun: company -> {\n  group_by: headquarters\n  aggregate: banking_count is count() { where: main_industry = 'Banking' }\n} -> {\n  where: banking_count = 0\n  select: headquarters\n}\n```",
      "pred_row_count": 2,
      "gold_row_count": 2
    },
    {
      "question_id": 6,
      "db_id": "activity_1",
      "question": "Which students participate in both Canoeing and Kayaking as their activities? Tell me their student ids.",
      "gold_sql": "SELECT T1.stuid FROM participates_in AS T1 JOIN activity AS T2 ON T2.actid  =  T2.actid WHERE T2.activity_name  =  'Canoeing' INTERSECT SELECT T1.stuid FROM participates_in AS T1 JOIN activity AS T2 ON T2.actid  =  T2.actid WHERE T2.activity_name  =  'Kayaking'",
      "predicted_malloy": "run: student -> {\n  group_by: stu_id\n  aggregate: \n    canoeing_count is count(participates_in.stu_id) { where: participates_in.activity.name = 'Canoeing' },\n    kayaking_count is count(participates_in.stu_id) { where: participates_in.activity.name = 'Kayaking' }\n} -> {\n  where: canoeing_count > 0 and kayaking_count > 0\n  select: stu_id\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"StuID\" as \"stu_id\",\n     count(distinct CASE WHEN (activity_0.\"activity_name\")='Canoeing' THEN (participates_in_0.\"stuid\") END) as \"canoeing_count\",\n     count(distinct CASE WHEN (activity_0.\"activity_name\")='Kayaking' THEN (participates_in_0.\"stuid\") END) as \"kayaking_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Student')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Participates_in')\n  ) AS participates_in_0\n    ON (base.\"StuID\")=(participates_in_0.\"stuid\")\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Activity')\n  ) AS activity_0\n    ON (participates_in_0.\"actid\")=(activity_0.\"actid\")\n  GROUP BY 1\n)\nSELECT \n   base.\"stu_id\" as \"stu_id\"\nFROM __stage0 as base\nWHERE (base.\"canoeing_count\">0)and(base.\"kayaking_count\">0)\n",
      "match": true,
      "error": null,
      "latency_ms": 4220.434188842773,
      "raw_response": "run: student -> {\n  group_by: stu_id\n  aggregate: \n    canoeing_count is count(participates_in.stu_id) { where: participates_in.activity.name = 'Canoeing' },\n    kayaking_count is count(participates_in.stu_id) { where: participates_in.activity.name = 'Kayaking' }\n} -> {\n  where: canoeing_count > 0 and kayaking_count > 0\n  select: stu_id\n}",
      "pred_row_count": 2,
      "gold_row_count": 2,
      "gold_sql_corrected": "SELECT T1.stuid FROM participates_in AS T1 JOIN activity AS T2 ON T1.actid = T2.actid WHERE T2.activity_name = 'Canoeing' INTERSECT SELECT T1.stuid FROM participates_in AS T1 JOIN activity AS T2 ON T1.actid = T2.actid WHERE T2.activity_name = 'Kayaking'"
    },
    {
      "question_id": 7,
      "db_id": "geo",
      "question": "which is the longest river in usa",
      "gold_sql": "SELECT river_name FROM river WHERE LENGTH  =  ( SELECT MAX ( LENGTH ) FROM river );",
      "predicted_malloy": "run: river -> { where: country_name = 'usa'; select: river_name, river_length; order_by: river_length desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"river_name\" as \"river_name\",\n   base.\"length\" as \"river_length\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'river')\n) as base\nWHERE base.\"country_name\"='usa'\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2064.7494792938232,
      "raw_response": "run: river -> { where: country_name = 'usa'; select: river_name, river_length; order_by: river_length desc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 8,
      "db_id": "customers_and_products_contacts",
      "question": "Show the names of customers who have both an order in completed status and an order in part status.",
      "gold_sql": "SELECT T1.customer_name FROM customers AS T1 JOIN customer_orders AS T2 ON T1.customer_id  =  T2.customer_id WHERE T2.order_status_code  =  'Completed' INTERSECT SELECT T1.customer_name FROM customers AS T1 JOIN customer_orders AS T2 ON T1.customer_id  =  T2.customer_id WHERE T2.order_status_code  =  'Part'",
      "predicted_malloy": "run: customers -> {\n  group_by: customer_name\n  aggregate: \n    completed_orders is count(customer_orders.order_id) { where: customer_orders.order_status_code = 'Completed' }\n    part_orders is count(customer_orders.order_id) { where: customer_orders.order_status_code = 'Part' }\n} -> {\n  where: completed_orders > 0 and part_orders > 0\n  select: customer_name\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"customer_name\" as \"customer_name\",\n     count(distinct CASE WHEN customer_orders_0.\"order_status_code\"='Completed' THEN customer_orders_0.\"order_id\" END) as \"completed_orders\",\n     count(distinct CASE WHEN customer_orders_0.\"order_status_code\"='Part' THEN customer_orders_0.\"order_id\" END) as \"part_orders\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/customers_and_products_contacts/customers_and_products_contacts.sqlite', 'Customers')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/customers_and_products_contacts/customers_and_products_contacts.sqlite', 'Customer_Orders')\n  ) AS customer_orders_0\n    ON base.\"customer_id\"=customer_orders_0.\"customer_id\"\n  GROUP BY 1\n)\nSELECT \n   base.\"customer_name\" as \"customer_name\"\nFROM __stage0 as base\nWHERE (base.\"completed_orders\">0)and(base.\"part_orders\">0)\n",
      "match": true,
      "error": null,
      "latency_ms": 4192.2502517700195,
      "raw_response": "```malloy\nrun: customers -> {\n  group_by: customer_name\n  aggregate: \n    completed_orders is count(customer_orders.order_id) { where: customer_orders.order_status_code = 'Completed' }\n    part_orders is count(customer_orders.order_id) { where: customer_orders.order_status_code = 'Part' }\n} -> {\n  where: completed_orders > 0 and part_orders > 0\n  select: customer_name\n}\n```",
      "pred_row_count": 3,
      "gold_row_count": 3
    },
    {
      "question_id": 9,
      "db_id": "behavior_monitoring",
      "question": "What are the line 1 of addresses shared by some students and some teachers?",
      "gold_sql": "SELECT T1.line_1 FROM Addresses AS T1 JOIN Students AS T2 ON T1.address_id  =  T2.address_id INTERSECT SELECT T1.line_1 FROM Addresses AS T1 JOIN Teachers AS T2 ON T1.address_id  =  T2.address_id",
      "predicted_malloy": "run: addresses -> {\n  group_by: line_1\n  aggregate: \n    student_count is count(students.student_id),\n    teacher_count is count(teachers.teacher_id)\n} -> {\n  where: student_count > 0 and teacher_count > 0\n  select: line_1\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"line_1\" as \"line_1\",\n     count(distinct students_0.\"student_id\") as \"student_count\",\n     count(distinct teachers_0.\"teacher_id\") as \"teacher_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/behavior_monitoring/behavior_monitoring.sqlite', 'Addresses')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/behavior_monitoring/behavior_monitoring.sqlite', 'Students')\n  ) AS students_0\n    ON base.\"address_id\"=students_0.\"address_id\"\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/behavior_monitoring/behavior_monitoring.sqlite', 'Teachers')\n  ) AS teachers_0\n    ON base.\"address_id\"=teachers_0.\"address_id\"\n  GROUP BY 1\n)\nSELECT \n   base.\"line_1\" as \"line_1\"\nFROM __stage0 as base\nWHERE (base.\"student_count\">0)and(base.\"teacher_count\">0)\n",
      "match": true,
      "error": null,
      "latency_ms": 3677.9847145080566,
      "raw_response": "run: addresses -> {\n  group_by: line_1\n  aggregate: \n    student_count is count(students.student_id),\n    teacher_count is count(teachers.teacher_id)\n} -> {\n  where: student_count > 0 and teacher_count > 0\n  select: line_1\n}",
      "pred_row_count": 7,
      "gold_row_count": 7
    },
    {
      "question_id": 20,
      "db_id": "movie_1",
      "question": "What is the average number of stars that each reviewer awards for a movie?",
      "gold_sql": "SELECT T2.name ,  avg(T1.stars) FROM Rating AS T1 JOIN Reviewer AS T2 ON T1.rID  =  T2.rID GROUP BY T2.name",
      "predicted_malloy": "run: reviewer -> {\n  group_by: reviewer_name\n  aggregate: avg_stars is rating.avg_stars\n}",
      "predicted_sql": "SELECT \n   base.\"name\" as \"reviewer_name\",\n   (AVG(rating_0.\"stars\")) as \"avg_stars\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/movie_1/movie_1.sqlite', 'Reviewer')\n) as base\n LEFT JOIN (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/movie_1/movie_1.sqlite', 'Rating')\n) AS rating_0\n  ON (base.\"rID\")=(rating_0.\"rID\")\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\n",
      "match": true,
      "error": null,
      "latency_ms": 2057.9874515533447,
      "raw_response": "run: reviewer -> {\n  group_by: reviewer_name\n  aggregate: avg_stars is rating.avg_stars\n}",
      "pred_row_count": 8,
      "gold_row_count": 8
    },
    {
      "question_id": 27,
      "db_id": "geo",
      "question": "what is the tallest mountain in the united states",
      "gold_sql": "SELECT mountain_name FROM mountain WHERE mountain_altitude  =  ( SELECT MAX ( mountain_altitude ) FROM mountain );",
      "predicted_malloy": "run: mountain -> { select: mountain_name, mountain_altitude; where: country_name = 'United States'; order_by: mountain_altitude desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"mountain_name\" as \"mountain_name\",\n   base.\"mountain_altitude\" as \"mountain_altitude\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'mountain')\n) as base\nWHERE base.\"country_name\"='United States'\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2798.2475757598877,
      "raw_response": "run: mountain -> { select: mountain_name, mountain_altitude; where: country_name = 'United States'; order_by: mountain_altitude desc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 28,
      "db_id": "scholar",
      "question": "main topics of work by Brian DeRenzi",
      "gold_sql": "SELECT DISTINCT t1.keyphrasename  ,  SUM ( t3.numcitedby ) FROM paperkeyphrase AS t2 JOIN keyphrase AS t1 ON t2.keyphraseid  =  t1.keyphraseid JOIN paper AS t3 ON t3.paperid  =  t2.paperid JOIN writes AS t4 ON t4.paperid  =  t3.paperid JOIN author AS t5 ON t4.authorid  =  t5.authorid WHERE t5.authorname  =  \"Brian DeRenzi\" GROUP BY t1.keyphrasename ORDER BY SUM ( t3.numcitedby ) DESC;",
      "predicted_malloy": "run: author -> {\n  where: author_name = 'Brian DeRenzi'\n  group_by: keyphrase.keyphrase_name\n  aggregate: paper_count is count(writes.paper.paper_keyphrase.paper_id)\n} -> {\n  where: paper_count > 0\n  select: keyphrase_name, paper_count\n  order_by: paper_count desc\n}",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: 'keyphrase' is not defined at line 3",
      "latency_ms": 1653.17702293396,
      "raw_response": "run: author -> {\n  where: author_name = 'Brian DeRenzi'\n  group_by: keyphrase.keyphrase_name\n  aggregate: paper_count is count(writes.paper.paper_keyphrase.paper_id)\n} -> {\n  where: paper_count > 0\n  select: keyphrase_name, paper_count\n  order_by: paper_count desc\n}"
    },
    {
      "question_id": 32,
      "db_id": "geo",
      "question": "what is the lowest point of all states through which the mississippi river runs through",
      "gold_sql": "SELECT lowest_point FROM highlow WHERE state_name IN ( SELECT traverse FROM river WHERE river_name  =  \"mississippi\" ) ORDER BY lowest_elevation LIMIT 1;",
      "predicted_malloy": "run: river -> {\n  where: river_name = 'mississippi'\n  select: traverse\n} -> {\n  group_by: state_name is traverse\n} -> {\n  join_one: highlow on state_name = highlow.state_name\n  select: highlow.lowest_point\n}",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: Joins in queries are deprecated, move into an `extend:` block. at line 7",
      "latency_ms": 3218.4157371520996,
      "raw_response": "run: river -> {\n  where: river_name = 'mississippi'\n  select: traverse\n} -> {\n  group_by: state_name is traverse\n} -> {\n  join_one: highlow on state_name = highlow.state_name\n  select: highlow.lowest_point\n}"
    },
    {
      "question_id": 35,
      "db_id": "geo",
      "question": "what is the largest capital",
      "gold_sql": "SELECT city_name FROM city WHERE population  =  ( SELECT MAX ( t1.population ) FROM state AS t2 JOIN city AS t1 ON t2.capital  =  t1.city_name );",
      "predicted_malloy": "run: state_val -> { select: capital, state_area; order_by: state_area desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"capital\" as \"capital\",\n   base.\"area\" as \"state_area\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'state')\n) as base\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2494.474172592163,
      "raw_response": "run: state_val -> { select: capital, state_area; order_by: state_area desc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 40,
      "db_id": "scholar",
      "question": "What is the most cited paper by ohad shamir ?",
      "gold_sql": "SELECT DISTINCT t4.citedpaperid  ,  COUNT ( t4.citedpaperid ) FROM paper AS t3 JOIN cite AS t4 ON t3.paperid  =  t4.citedpaperid JOIN writes AS t2 ON t2.paperid  =  t3.paperid JOIN author AS t1 ON t2.authorid  =  t1.authorid WHERE t1.authorname  =  \"ohad shamir\" GROUP BY t4.citedpaperid ORDER BY COUNT ( t4.citedpaperid ) DESC;",
      "predicted_malloy": "run: author -> {\n  where: author_name = 'ohad shamir'\n  group_by: writes.paper.paper_id, writes.paper.title\n  aggregate: citation_count is count(writes.paper.cite_cited_paper.citing_paper_id)\n} -> {\n  order_by: citation_count desc\n  limit: 1\n  select: writes.paper.title\n}",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: 'cite_cited_paper' is not defined at line 4",
      "latency_ms": 4217.21339225769,
      "raw_response": "run: author -> {\n  where: author_name = 'ohad shamir'\n  group_by: writes.paper.paper_id, writes.paper.title\n  aggregate: citation_count is count(writes.paper.cite_cited_paper.citing_paper_id)\n} -> {\n  order_by: citation_count desc\n  limit: 1\n  select: writes.paper.title\n}"
    },
    {
      "question_id": 46,
      "db_id": "geo",
      "question": "what state has the sparsest population density",
      "gold_sql": "SELECT state_name FROM state WHERE density  =  ( SELECT MIN ( density ) FROM state );",
      "predicted_malloy": "run: state_val -> { select: state_name, state_density; order_by: state_density asc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"state_name\" as \"state_name\",\n   base.\"density\" as \"state_density\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'state')\n) as base\nORDER BY 2 asc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2352.3457050323486,
      "raw_response": "run: state_val -> { select: state_name, state_density; order_by: state_density asc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 47,
      "db_id": "activity_1",
      "question": "What is the first and last name of the faculty members who participated in at least one activity? For each of them, also show the number of activities they participated in.",
      "gold_sql": "SELECT  T1.fname ,  T1.lname ,  count(*) ,  T1.FacID FROM Faculty AS T1 JOIN Faculty_participates_in AS T2 ON T1.facID  =  T2.facID GROUP BY T1.FacID",
      "predicted_malloy": "run: faculty -> {\n  group_by: first_name, last_name\n  aggregate: activity_count is count(faculty_participates_in.fac_id)\n} -> {\n  where: activity_count > 0\n  select: first_name, last_name, activity_count\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"Fname\" as \"first_name\",\n     base.\"Lname\" as \"last_name\",\n     count(distinct (faculty_participates_in_0.\"FacID\")) as \"activity_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Faculty')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Faculty_Participates_in')\n  ) AS faculty_participates_in_0\n    ON (base.\"FacID\")=(faculty_participates_in_0.\"FacID\")\n  GROUP BY 1,2\n)\nSELECT \n   base.\"first_name\" as \"first_name\",\n   base.\"last_name\" as \"last_name\",\n   base.\"activity_count\" as \"activity_count\"\nFROM __stage0 as base\nWHERE base.\"activity_count\">0\n",
      "match": false,
      "error": null,
      "latency_ms": 3182.650566101074,
      "raw_response": "```malloy\nrun: faculty -> {\n  group_by: first_name, last_name\n  aggregate: activity_count is count(faculty_participates_in.fac_id)\n} -> {\n  where: activity_count > 0\n  select: first_name, last_name, activity_count\n}\n```",
      "pred_row_count": 18,
      "gold_row_count": 18
    },
    {
      "question_id": 55,
      "db_id": "geo",
      "question": "what is the biggest state",
      "gold_sql": "SELECT state_name FROM state WHERE area  =  ( SELECT MAX ( area ) FROM state );",
      "predicted_malloy": "run: state_val -> { select: state_name, state_area; order_by: state_area desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"state_name\" as \"state_name\",\n   base.\"area\" as \"state_area\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'state')\n) as base\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2046.5149879455566,
      "raw_response": "run: state_val -> { select: state_name, state_area; order_by: state_area desc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 56,
      "db_id": "scholar",
      "question": "count of ACL papers by author",
      "gold_sql": "SELECT DISTINCT COUNT ( t2.paperid )  ,  t1.authorid FROM venue AS t3 JOIN paper AS t2 ON t3.venueid  =  t2.venueid JOIN writes AS t1 ON t1.paperid  =  t2.paperid WHERE t3.venuename  =  \"ACL\" GROUP BY t1.authorid;",
      "predicted_malloy": "run: author -> {\n  group_by: author_name\n  aggregate: acl_paper_count is count(writes.paper.paper_id) { where: writes.paper.venue.venue_name = 'ACL' }\n} -> {\n  where: acl_paper_count > 0\n  select: author_name, acl_paper_count\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"authorName\" as \"author_name\",\n     count(distinct CASE WHEN (venue_0.\"venueName\")='ACL' THEN (paper_0.\"paperId\") END) as \"acl_paper_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/scholar/scholar.sqlite', 'author')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/scholar/scholar.sqlite', 'writes')\n  ) AS writes_0\n    ON (base.\"authorId\")=(writes_0.\"authorId\")\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/scholar/scholar.sqlite', 'paper')\n  ) AS paper_0\n    ON (writes_0.\"paperId\")=(paper_0.\"paperId\")\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/scholar/scholar.sqlite', 'venue')\n  ) AS venue_0\n    ON (paper_0.\"venueId\")=(venue_0.\"venueId\")\n  GROUP BY 1\n)\nSELECT \n   base.\"author_name\" as \"author_name\",\n   base.\"acl_paper_count\" as \"acl_paper_count\"\nFROM __stage0 as base\nWHERE base.\"acl_paper_count\">0\n",
      "match": true,
      "error": null,
      "latency_ms": 4002.312660217285,
      "raw_response": "```malloy\nrun: author -> {\n  group_by: author_name\n  aggregate: acl_paper_count is count(writes.paper.paper_id) { where: writes.paper.venue.venue_name = 'ACL' }\n} -> {\n  where: acl_paper_count > 0\n  select: author_name, acl_paper_count\n}\n```",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 58,
      "db_id": "geo",
      "question": "what rivers flow through the state with the largest population",
      "gold_sql": "SELECT river_name FROM river WHERE traverse IN ( SELECT state_name FROM state WHERE population  =  ( SELECT MAX ( population ) FROM state ) );",
      "predicted_malloy": "run: river -> {\n  group_by: river_name\n  aggregate: flows_through_largest_pop_state is count(state_val.state_name) { where: state_val.state_population = (run: state_val -> { aggregate: max_pop is max(state_population) } -> { select: max_pop }) }\n} -> {\n  where: flows_through_largest_pop_state > 0\n  select: river_name\n}",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: extraneous input 'run:' expecting {ALL, AVG, CAST, COUNT, DAY, EXCLUDE, FALSE, HOUR, MAX, MIN, MINUTE, MONTH, NOT, NOW, NULL, PICK, QUARTER, SECOND, SOURCE_KW, SUM, TRUE, WEEK, YEAR, HACKY_REGEX, SQ_STRING, DQ_STRING, BQ_STRING, '(', '<', '>', '=', '!=', '<=', '>=', '-', '!~', '~', LITERAL_TIMESTAMP, LITERAL_HOUR, LITERAL_DAY, LITERAL_QUARTER, LITERAL_MONTH, LITERAL_WEEK, LITERAL_YEAR, IDENTIFIER, NUMERIC_LITERAL, INTEGER_LITERAL, '\"\"\"'} at line 3",
      "latency_ms": 4175.7848262786865,
      "raw_response": "```malloy\nrun: river -> {\n  group_by: river_name\n  aggregate: flows_through_largest_pop_state is count(state_val.state_name) { where: state_val.state_population = (run: state_val -> { aggregate: max_pop is max(state_population) } -> { select: max_pop }) }\n} -> {\n  where: flows_through_largest_pop_state > 0\n  select: river_name\n}\n```"
    },
    {
      "question_id": 59,
      "db_id": "geo",
      "question": "where is the highest mountain of the united states",
      "gold_sql": "SELECT state_name FROM mountain WHERE mountain_altitude  =  ( SELECT MAX ( mountain_altitude ) FROM mountain );",
      "predicted_malloy": "run: mountain -> { select: state_name, mountain_altitude; order_by: mountain_altitude desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"state_name\" as \"state_name\",\n   base.\"mountain_altitude\" as \"mountain_altitude\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'mountain')\n) as base\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2110.738754272461,
      "raw_response": "run: mountain -> { select: state_name, mountain_altitude; order_by: mountain_altitude desc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 63,
      "db_id": "movie_1",
      "question": "What are the movie titles with the highest average rating and what are those ratings?",
      "gold_sql": "SELECT T2.title ,  avg(T1.stars) FROM Rating AS T1 JOIN Movie AS T2 ON T1.mID  =  T2.mID GROUP BY T1.mID ORDER BY avg(T1.stars) DESC LIMIT 1",
      "predicted_malloy": "run: movie -> {\n  group_by: movie_title\n  aggregate: avg_rating is avg(rating.star_rating)\n} -> {\n  select: movie_title, avg_rating\n  order_by: avg_rating desc\n  limit: 1\n}",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: Join path is required for this calculation; use `rating.star_rating.avg()` at line 3",
      "latency_ms": 1373.1448650360107,
      "raw_response": "run: movie -> {\n  group_by: movie_title\n  aggregate: avg_rating is avg(rating.star_rating)\n} -> {\n  select: movie_title, avg_rating\n  order_by: avg_rating desc\n  limit: 1\n}"
    },
    {
      "question_id": 64,
      "db_id": "geo",
      "question": "what is the lowest point of the state with the largest area",
      "gold_sql": "SELECT t2.lowest_point FROM state AS t1 JOIN highlow AS t2 ON t1.state_name  =  t2.state_name WHERE t1.state_name IN ( SELECT state_name FROM state WHERE area  =  ( SELECT MAX ( area ) FROM state ) );",
      "predicted_malloy": "run: state_val -> {\n  select: state_name, state_area\n  order_by: state_area desc\n  limit: 1\n} -> {\n  select: state_name\n  join_one: highlow on state_name = highlow.state_name\n  select: highlow.lowest_point\n}",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: Joins in queries are deprecated, move into an `extend:` block. at line 7",
      "latency_ms": 3394.5529460906982,
      "raw_response": "```malloy\nrun: state_val -> {\n  select: state_name, state_area\n  order_by: state_area desc\n  limit: 1\n} -> {\n  select: state_name\n  join_one: highlow on state_name = highlow.state_name\n  select: highlow.lowest_point\n}\n```"
    },
    {
      "question_id": 65,
      "db_id": "geo",
      "question": "how large is the largest city in alaska",
      "gold_sql": "SELECT population FROM city WHERE population  =  ( SELECT MAX ( population ) FROM city WHERE state_name  =  \"alaska\" ) AND state_name  =  \"alaska\";",
      "predicted_malloy": "run: city -> { where: state_name = 'Alaska'; select: city_name, population; order_by: population desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"city_name\" as \"city_name\",\n   base.\"population\" as \"population\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'city')\n) as base\nWHERE base.\"state_name\"='Alaska'\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2688.035726547241,
      "raw_response": "run: city -> { where: state_name = 'Alaska'; select: city_name, population; order_by: population desc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 81,
      "db_id": "geo",
      "question": "what states border the state with the smallest area",
      "gold_sql": "SELECT border FROM border_info WHERE state_name  =  ( SELECT state_name FROM state WHERE area  =  ( SELECT MIN ( area ) FROM state ) );",
      "predicted_malloy": "run: state_val -> {\n  group_by: state_name, state_area\n} -> {\n  order_by: state_area asc\n  limit: 1\n} -> {\n  join_one: border_state is state_val on border_state.border_info_state_name.state_name = state_val.state_name\n  select: border_state.state_name\n}",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: Joins in queries are deprecated, move into an `extend:` block. at line 7",
      "latency_ms": 4130.05256652832,
      "raw_response": "```malloy\nrun: state_val -> {\n  group_by: state_name, state_area\n} -> {\n  order_by: state_area asc\n  limit: 1\n} -> {\n  join_one: border_state is state_val on border_state.border_info_state_name.state_name = state_val.state_name\n  select: border_state.state_name\n}\n```"
    },
    {
      "question_id": 91,
      "db_id": "movie_1",
      "question": "What are the ids of all moviest hat have not been reviewed by Britanny Harris?",
      "gold_sql": "SELECT mID FROM Rating EXCEPT SELECT T1.mID FROM Rating AS T1 JOIN Reviewer AS T2 ON T1.rID  =  T2.rID WHERE T2.name  =  \"Brittany Harris\"",
      "predicted_malloy": "run: movie -> {\n  group_by: m_id\n  aggregate: \n    brittany_ratings is count(rating.r_id) { where: rating.reviewer.reviewer_name = 'Brittany Harris' }\n} -> {\n  where: brittany_ratings = 0\n  select: m_id\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"mID\" as \"m_id\",\n     count(distinct CASE WHEN (reviewer_0.\"name\")='Brittany Harris' THEN (rating_0.\"rID\") END) as \"brittany_ratings\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/movie_1/movie_1.sqlite', 'Movie')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/movie_1/movie_1.sqlite', 'Rating')\n  ) AS rating_0\n    ON (base.\"mID\")=(rating_0.\"mID\")\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/movie_1/movie_1.sqlite', 'Reviewer')\n  ) AS reviewer_0\n    ON (rating_0.\"rID\")=(reviewer_0.\"rID\")\n  GROUP BY 1\n)\nSELECT \n   base.\"m_id\" as \"m_id\"\nFROM __stage0 as base\nWHERE base.\"brittany_ratings\"=0\n",
      "match": false,
      "error": null,
      "latency_ms": 3790.2822494506836,
      "raw_response": "run: movie -> {\n  group_by: m_id\n  aggregate: \n    brittany_ratings is count(rating.r_id) { where: rating.reviewer.reviewer_name = 'Brittany Harris' }\n} -> {\n  where: brittany_ratings = 0\n  select: m_id\n}",
      "pred_row_count": 6,
      "gold_row_count": 4
    },
    {
      "question_id": 106,
      "db_id": "game_1",
      "question": "Show student ids who are on scholarship and have major 600.",
      "gold_sql": "SELECT StuID FROM Student WHERE major  =  600 INTERSECT SELECT StuID FROM Sportsinfo WHERE onscholarship  =  'Y'",
      "predicted_malloy": "run: student -> {\n  where: major = 600\n  group_by: stu_id\n  aggregate: has_scholarship is count(sports_info.stu_id) { where: sports_info.on_scholarship = 'Y' }\n} -> {\n  where: has_scholarship > 0\n  select: stu_id\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"StuID\" as \"stu_id\",\n     count(distinct CASE WHEN (sports_info_0.\"OnScholarship\")='Y' THEN (sports_info_0.\"StuID\") END) as \"has_scholarship\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/game_1/game_1.sqlite', 'Student')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/game_1/game_1.sqlite', 'SportsInfo')\n  ) AS sports_info_0\n    ON (base.\"StuID\")=(sports_info_0.\"StuID\")\n  WHERE (base.\"Major\")=600\n  GROUP BY 1\n)\nSELECT \n   base.\"stu_id\" as \"stu_id\"\nFROM __stage0 as base\nWHERE base.\"has_scholarship\">0\n",
      "match": true,
      "error": null,
      "latency_ms": 3614.084005355835,
      "raw_response": "```malloy\nrun: student -> {\n  where: major = 600\n  group_by: stu_id\n  aggregate: has_scholarship is count(sports_info.stu_id) { where: sports_info.on_scholarship = 'Y' }\n} -> {\n  where: has_scholarship > 0\n  select: stu_id\n}\n```",
      "pred_row_count": 4,
      "gold_row_count": 4
    },
    {
      "question_id": 110,
      "db_id": "movie_1",
      "question": "What is the name of the movie that has been reviewed the most?",
      "gold_sql": "SELECT T2.title ,  T1.mID FROM Rating AS T1 JOIN Movie AS T2 ON T1.mID  =  T2.mID GROUP BY T1.mID ORDER BY count(*) DESC LIMIT 1",
      "predicted_malloy": "run: movie -> {\n  group_by: movie_title\n  aggregate: review_count is count(rating.r_id)\n} -> {\n  select: movie_title, review_count\n  order_by: review_count desc\n  limit: 1\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"title\" as \"movie_title\",\n     count(distinct (rating_0.\"rID\")) as \"review_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/movie_1/movie_1.sqlite', 'Movie')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/movie_1/movie_1.sqlite', 'Rating')\n  ) AS rating_0\n    ON (base.\"mID\")=(rating_0.\"mID\")\n  GROUP BY 1\n)\nSELECT \n   base.\"movie_title\" as \"movie_title\",\n   base.\"review_count\" as \"review_count\"\nFROM __stage0 as base\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": false,
      "error": null,
      "latency_ms": 3333.3120346069336,
      "raw_response": "run: movie -> {\n  group_by: movie_title\n  aggregate: review_count is count(rating.r_id)\n} -> {\n  select: movie_title, review_count\n  order_by: review_count desc\n  limit: 1\n}",
      "pred_row_count": 1,
      "gold_row_count": 1
    },
    {
      "question_id": 111,
      "db_id": "geo",
      "question": "what is the capital of the state with the most inhabitants",
      "gold_sql": "SELECT capital FROM state WHERE population  =  ( SELECT MAX ( population ) FROM state );",
      "predicted_malloy": "run: state_val -> { select: capital, state_population; order_by: state_population desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"capital\" as \"capital\",\n   base.\"population\" as \"state_population\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'state')\n) as base\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2465.771198272705,
      "raw_response": "run: state_val -> { select: capital, state_population; order_by: state_population desc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 114,
      "db_id": "movie_1",
      "question": "Return all reviewer names and movie names together in a single list.",
      "gold_sql": "SELECT name FROM Reviewer UNION SELECT title FROM Movie",
      "predicted_malloy": "run: reviewer -> { select: reviewer_name } -> { select: name is reviewer_name } | run: movie -> { select: movie_title } -> { select: name is movie_title }",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: extraneous input '|' expecting {<EOF>, AGGREGATE, CALCULATE, DIMENSION, GROUP_BY, JOIN_CROSS, JOIN_ONE, JOIN_MANY, MEASURE, NEST, PROJECT, QUERY, RUN, SELECT, SOURCE, VIEW, ALL, AVG, CAST, COUNT, DAY, EXCLUDE, FALSE, HOUR, IMPORT, IS, MAX, MIN, MINUTE, MONTH, NOT, NOW, NULL, PICK, QUARTER, SECOND, SOURCE_KW, SUM, TABLE, TRUE, WEEK, YEAR, HACKY_REGEX, SQ_STRING, DQ_STRING, BQ_STRING, DOC_ANNOTATION, ANNOTATION, '(', '{', '-', ';', LITERAL_TIMESTAMP, LITERAL_HOUR, LITERAL_DAY, LITERAL_QUARTER, LITERAL_MONTH, LITERAL_WEEK, LITERAL_YEAR, IDENTIFIER, NUMERIC_LITERAL, INTEGER_LITERAL, '\"\"\"'} at line 1",
      "latency_ms": 2471.606969833374,
      "raw_response": "run: reviewer -> { select: reviewer_name } -> { select: name is reviewer_name } | run: movie -> { select: movie_title } -> { select: name is movie_title }"
    },
    {
      "question_id": 117,
      "db_id": "scholar",
      "question": "What is the most cited paper of ohad shamir ?",
      "gold_sql": "SELECT DISTINCT t4.citedpaperid  ,  COUNT ( t4.citedpaperid ) FROM paper AS t3 JOIN cite AS t4 ON t3.paperid  =  t4.citedpaperid JOIN writes AS t2 ON t2.paperid  =  t3.paperid JOIN author AS t1 ON t2.authorid  =  t1.authorid WHERE t1.authorname  =  \"ohad shamir\" GROUP BY t4.citedpaperid ORDER BY COUNT ( t4.citedpaperid ) DESC;",
      "predicted_malloy": "run: author -> {\n  where: author_name = 'ohad shamir'\n  group_by: writes.paper.title\n  aggregate: citation_count is count(cite_cited_paper.citing_paper_id)\n} -> {\n  order_by: citation_count desc\n  limit: 1\n  select: title, citation_count\n}",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: 'cite_cited_paper' is not defined at line 4",
      "latency_ms": 1283.909559249878,
      "raw_response": "run: author -> {\n  where: author_name = 'ohad shamir'\n  group_by: writes.paper.title\n  aggregate: citation_count is count(cite_cited_paper.citing_paper_id)\n} -> {\n  order_by: citation_count desc\n  limit: 1\n  select: title, citation_count\n}"
    },
    {
      "question_id": 124,
      "db_id": "behavior_monitoring",
      "question": "Find the last names of teachers who are not involved in any detention.",
      "gold_sql": "SELECT last_name FROM Teachers EXCEPT SELECT T1.last_name FROM Teachers AS T1 JOIN Detention AS T2 ON T1.teacher_id  =  T2.teacher_id",
      "predicted_malloy": "run: teachers -> {\n  group_by: last_name\n  aggregate: detention_count is count(detention.teacher_id)\n} -> {\n  where: detention_count = 0\n  select: last_name\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"last_name\" as \"last_name\",\n     count(distinct detention_0.\"teacher_id\") as \"detention_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/behavior_monitoring/behavior_monitoring.sqlite', 'Teachers')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/behavior_monitoring/behavior_monitoring.sqlite', 'Detention')\n  ) AS detention_0\n    ON base.\"teacher_id\"=detention_0.\"teacher_id\"\n  GROUP BY 1\n)\nSELECT \n   base.\"last_name\" as \"last_name\"\nFROM __stage0 as base\nWHERE base.\"detention_count\"=0\n",
      "match": true,
      "error": null,
      "latency_ms": 2820.2106952667236,
      "raw_response": "```malloy\nrun: teachers -> {\n  group_by: last_name\n  aggregate: detention_count is count(detention.teacher_id)\n} -> {\n  where: detention_count = 0\n  select: last_name\n}\n```",
      "pred_row_count": 5,
      "gold_row_count": 5
    },
    {
      "question_id": 133,
      "db_id": "activity_1",
      "question": "Show the ids of all the faculty members who participate in an activity and advise a student.",
      "gold_sql": "SELECT FacID FROM Faculty_participates_in INTERSECT SELECT advisor FROM Student",
      "predicted_malloy": "run: faculty -> {\n  group_by: fac_id\n  aggregate: \n    activity_count is count(faculty_participates_in.fac_id),\n    student_count is count(student.stu_id)\n} -> {\n  where: activity_count > 0 and student_count > 0\n  select: fac_id\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"FacID\" as \"fac_id\",\n     count(distinct (faculty_participates_in_0.\"FacID\")) as \"activity_count\",\n     count(distinct (student_0.\"StuID\")) as \"student_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Faculty')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Faculty_Participates_in')\n  ) AS faculty_participates_in_0\n    ON (base.\"FacID\")=(faculty_participates_in_0.\"FacID\")\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Student')\n  ) AS student_0\n    ON (base.\"FacID\")=(student_0.\"Advisor\")\n  GROUP BY 1\n)\nSELECT \n   base.\"fac_id\" as \"fac_id\"\nFROM __stage0 as base\nWHERE (base.\"activity_count\">0)and(base.\"student_count\">0)\n",
      "match": true,
      "error": null,
      "latency_ms": 3664.456844329834,
      "raw_response": "run: faculty -> {\n  group_by: fac_id\n  aggregate: \n    activity_count is count(faculty_participates_in.fac_id),\n    student_count is count(student.stu_id)\n} -> {\n  where: activity_count > 0 and student_count > 0\n  select: fac_id\n}",
      "pred_row_count": 7,
      "gold_row_count": 7
    },
    {
      "question_id": 136,
      "db_id": "geo",
      "question": "what state has the longest river",
      "gold_sql": "SELECT DISTINCT traverse FROM river WHERE LENGTH  =  ( SELECT MAX ( DISTINCT LENGTH ) FROM river );",
      "predicted_malloy": "run: river -> {\n  group_by: traverse\n  aggregate: max_length is max(length)\n} -> {\n  select: traverse, max_length\n  order_by: max_length desc\n  limit: 1\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"traverse\" as \"traverse\",\n     max(base.\"length\") as \"max_length\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'river')\n  ) as base\n  GROUP BY 1\n)\nSELECT \n   base.\"traverse\" as \"traverse\",\n   base.\"max_length\" as \"max_length\"\nFROM __stage0 as base\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2903.752565383911,
      "raw_response": "```malloy\nrun: river -> {\n  group_by: traverse\n  aggregate: max_length is max(length)\n} -> {\n  select: traverse, max_length\n  order_by: max_length desc\n  limit: 1\n}\n```",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 144,
      "db_id": "gas_company",
      "question": "What are the headquarters without companies that are in the banking industry?",
      "gold_sql": "SELECT headquarters FROM company EXCEPT SELECT headquarters FROM company WHERE main_industry  =  'Banking'",
      "predicted_malloy": "run: company -> {\n  group_by: headquarters\n  aggregate: banking_count is count() { where: main_industry = 'Banking' }\n} -> {\n  where: banking_count = 0\n  select: headquarters\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"Headquarters\" as \"headquarters\",\n     COUNT(CASE WHEN (base.\"Main_Industry\")='Banking' THEN 1 END) as \"banking_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/gas_company/gas_company.sqlite', 'company')\n  ) as base\n  GROUP BY 1\n)\nSELECT \n   base.\"headquarters\" as \"headquarters\"\nFROM __stage0 as base\nWHERE base.\"banking_count\"=0\n",
      "match": true,
      "error": null,
      "latency_ms": 2773.975610733032,
      "raw_response": "run: company -> {\n  group_by: headquarters\n  aggregate: banking_count is count() { where: main_industry = 'Banking' }\n} -> {\n  where: banking_count = 0\n  select: headquarters\n}",
      "pred_row_count": 2,
      "gold_row_count": 2
    },
    {
      "question_id": 148,
      "db_id": "geo",
      "question": "which state is the smallest",
      "gold_sql": "SELECT state_name FROM state WHERE area  =  ( SELECT MIN ( area ) FROM state );",
      "predicted_malloy": "run: state_val -> { select: state_name, state_area; order_by: state_area asc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"state_name\" as \"state_name\",\n   base.\"area\" as \"state_area\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'state')\n) as base\nORDER BY 2 asc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2785.165309906006,
      "raw_response": "run: state_val -> { select: state_name, state_area; order_by: state_area asc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 150,
      "db_id": "movie_1",
      "question": "For each director, what are the titles and ratings for all the movies they reviewed?",
      "gold_sql": "SELECT T2.title ,  T1.stars ,  T2.director ,  max(T1.stars) FROM Rating AS T1 JOIN Movie AS T2 ON T1.mID  =  T2.mID WHERE director != \"null\" GROUP BY director",
      "predicted_malloy": "run: reviewer -> {\n  group_by: directed_by is rating.movie.directed_by\n  nest: movies_reviewed is {\n    group_by: movie_title is rating.movie.movie_title\n    aggregate: rating_given is rating.star_rating\n  }\n}",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: 'movie' is not defined at line 2",
      "latency_ms": 3266.5486335754395,
      "raw_response": "run: reviewer -> {\n  group_by: directed_by is rating.movie.directed_by\n  nest: movies_reviewed is {\n    group_by: movie_title is rating.movie.movie_title\n    aggregate: rating_given is rating.star_rating\n  }\n}"
    },
    {
      "question_id": 152,
      "db_id": "activity_1",
      "question": "Show ids for the faculty members who don't advise any student.",
      "gold_sql": "SELECT FacID FROM Faculty EXCEPT SELECT advisor FROM Student",
      "predicted_malloy": "run: faculty -> {\n  group_by: fac_id\n  aggregate: advisee_count is count(student.stu_id)\n} -> {\n  where: advisee_count = 0\n  select: fac_id\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"FacID\" as \"fac_id\",\n     count(distinct (student_0.\"StuID\")) as \"advisee_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Faculty')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Student')\n  ) AS student_0\n    ON (base.\"FacID\")=(student_0.\"Advisor\")\n  GROUP BY 1\n)\nSELECT \n   base.\"fac_id\" as \"fac_id\"\nFROM __stage0 as base\nWHERE base.\"advisee_count\"=0\n",
      "match": true,
      "error": null,
      "latency_ms": 2744.6513175964355,
      "raw_response": "run: faculty -> {\n  group_by: fac_id\n  aggregate: advisee_count is count(student.stu_id)\n} -> {\n  where: advisee_count = 0\n  select: fac_id\n}",
      "pred_row_count": 40,
      "gold_row_count": 40
    },
    {
      "question_id": 162,
      "db_id": "activity_1",
      "question": "What are the first names of the professors who do not play Canoeing or Kayaking as activities?",
      "gold_sql": "SELECT lname FROM faculty WHERE rank  =  'Professor' EXCEPT SELECT DISTINCT T1.lname FROM Faculty AS T1 JOIN Faculty_participates_in AS T2 ON T1.facID  =  T2.facID JOIN activity AS T3 ON T2.actid  =  T2.actid WHERE T3.activity_name  =  'Canoeing' OR T3.activity_name  =  'Kayaking'",
      "predicted_malloy": "run: faculty -> {\n  group_by: first_name\n  aggregate: \n    canoeing_count is count(faculty_participates_in.act_id) { where: faculty_participates_in.activity.name = 'Canoeing' }\n    kayaking_count is count(faculty_participates_in.act_id) { where: faculty_participates_in.activity.name = 'Kayaking' }\n} -> {\n  where: canoeing_count = 0 and kayaking_count = 0\n  select: first_name\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"Fname\" as \"first_name\",\n     count(distinct CASE WHEN (activity_0.\"activity_name\")='Canoeing' THEN (faculty_participates_in_0.\"actid\") END) as \"canoeing_count\",\n     count(distinct CASE WHEN (activity_0.\"activity_name\")='Kayaking' THEN (faculty_participates_in_0.\"actid\") END) as \"kayaking_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Faculty')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Faculty_Participates_in')\n  ) AS faculty_participates_in_0\n    ON (base.\"FacID\")=(faculty_participates_in_0.\"FacID\")\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Activity')\n  ) AS activity_0\n    ON (faculty_participates_in_0.\"actid\")=(activity_0.\"actid\")\n  GROUP BY 1\n)\nSELECT \n   base.\"first_name\" as \"first_name\"\nFROM __stage0 as base\nWHERE (base.\"canoeing_count\"=0)and(base.\"kayaking_count\"=0)\n",
      "match": false,
      "error": null,
      "latency_ms": 5479.058265686035,
      "raw_response": "run: faculty -> {\n  group_by: first_name\n  aggregate: \n    canoeing_count is count(faculty_participates_in.act_id) { where: faculty_participates_in.activity.name = 'Canoeing' }\n    kayaking_count is count(faculty_participates_in.act_id) { where: faculty_participates_in.activity.name = 'Kayaking' }\n} -> {\n  where: canoeing_count = 0 and kayaking_count = 0\n  select: first_name\n}",
      "pred_row_count": 48,
      "gold_row_count": 25,
      "gold_sql_corrected": "SELECT lname FROM faculty WHERE rank = 'Professor' EXCEPT SELECT DISTINCT T1.lname FROM Faculty AS T1 JOIN Faculty_participates_in AS T2 ON T1.facID = T2.facID JOIN activity AS T3 ON T2.actid = T3.actid WHERE T3.activity_name = 'Canoeing' OR T3.activity_name = 'Kayaking'"
    },
    {
      "question_id": 180,
      "db_id": "geo",
      "question": "what is the capital of the state with the largest population",
      "gold_sql": "SELECT capital FROM state WHERE population  =  ( SELECT MAX ( population ) FROM state );",
      "predicted_malloy": "run: state_val -> { select: state_name, capital, state_population; order_by: state_population desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"state_name\" as \"state_name\",\n   base.\"capital\" as \"capital\",\n   base.\"population\" as \"state_population\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'state')\n) as base\nORDER BY 3 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2296.9677448272705,
      "raw_response": "```malloy\nrun: state_val -> { select: state_name, capital, state_population; order_by: state_population desc; limit: 1 }\n```",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 185,
      "db_id": "geo",
      "question": "what is the largest city in wyoming",
      "gold_sql": "SELECT city_name FROM city WHERE population  =  ( SELECT MAX ( population ) FROM city WHERE state_name  =  \"wyoming\" ) AND state_name  =  \"wyoming\";",
      "predicted_malloy": "run: city -> { where: state_name = 'wyoming'; select: city_name, population; order_by: population desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"city_name\" as \"city_name\",\n   base.\"population\" as \"population\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'city')\n) as base\nWHERE base.\"state_name\"='wyoming'\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2268.038272857666,
      "raw_response": "run: city -> { where: state_name = 'wyoming'; select: city_name, population; order_by: population desc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 189,
      "db_id": "geo",
      "question": "which state has the most population",
      "gold_sql": "SELECT state_name FROM state WHERE population  =  ( SELECT MAX ( population ) FROM state );",
      "predicted_malloy": "run: state_val -> { select: state_name, state_population; order_by: state_population desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"state_name\" as \"state_name\",\n   base.\"population\" as \"state_population\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'state')\n) as base\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2701.1704444885254,
      "raw_response": "run: state_val -> { select: state_name, state_population; order_by: state_population desc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 197,
      "db_id": "geo",
      "question": "what is the most populous state in the us",
      "gold_sql": "SELECT state_name FROM state WHERE population  =  ( SELECT MAX ( population ) FROM state );",
      "predicted_malloy": "run: state_val -> { select: state_name, state_population; order_by: state_population desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"state_name\" as \"state_name\",\n   base.\"population\" as \"state_population\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'state')\n) as base\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2470.977783203125,
      "raw_response": "run: state_val -> { select: state_name, state_population; order_by: state_population desc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 198,
      "db_id": "ship_1",
      "question": "What are the names of ships that are commanded by both captains with the rank of Midshipman and captains with the rank of Lieutenant?",
      "gold_sql": "SELECT t1.name FROM ship AS t1 JOIN captain AS t2 ON t1.ship_id  =  t2.ship_id WHERE t2.rank  =  'Midshipman' INTERSECT SELECT t1.name FROM ship AS t1 JOIN captain AS t2 ON t1.ship_id  =  t2.ship_id WHERE t2.rank  =  'Lieutenant'",
      "predicted_malloy": "run: ship -> {\n  group_by: ship_name\n  aggregate: \n    midshipman_count is count(captain.captain_id) { where: captain.rank = 'Midshipman' }\n    lieutenant_count is count(captain.captain_id) { where: captain.rank = 'Lieutenant' }\n} -> {\n  where: midshipman_count > 0 and lieutenant_count > 0\n  select: ship_name\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"Name\" as \"ship_name\",\n     count(distinct CASE WHEN (captain_0.\"Rank\")='Midshipman' THEN (captain_0.\"Captain_ID\") END) as \"midshipman_count\",\n     count(distinct CASE WHEN (captain_0.\"Rank\")='Lieutenant' THEN (captain_0.\"Captain_ID\") END) as \"lieutenant_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/ship_1/ship_1.sqlite', 'Ship')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/ship_1/ship_1.sqlite', 'captain')\n  ) AS captain_0\n    ON (base.\"Ship_ID\")=(captain_0.\"Ship_ID\")\n  GROUP BY 1\n)\nSELECT \n   base.\"ship_name\" as \"ship_name\"\nFROM __stage0 as base\nWHERE (base.\"midshipman_count\">0)and(base.\"lieutenant_count\">0)\n",
      "match": true,
      "error": null,
      "latency_ms": 4268.669605255127,
      "raw_response": "```malloy\nrun: ship -> {\n  group_by: ship_name\n  aggregate: \n    midshipman_count is count(captain.captain_id) { where: captain.rank = 'Midshipman' }\n    lieutenant_count is count(captain.captain_id) { where: captain.rank = 'Lieutenant' }\n} -> {\n  where: midshipman_count > 0 and lieutenant_count > 0\n  select: ship_name\n}\n```",
      "pred_row_count": 1,
      "gold_row_count": 1
    },
    {
      "question_id": 199,
      "db_id": "geo",
      "question": "what states does the shortest river run through",
      "gold_sql": "SELECT traverse FROM river WHERE LENGTH  =  ( SELECT MIN ( LENGTH ) FROM river );",
      "predicted_malloy": "run: river -> { select: river_name, river_length, traverses; order_by: river_length asc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"river_name\" as \"river_name\",\n   base.\"length\" as \"river_length\",\n   base.\"traverse\" as \"traverses\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'river')\n) as base\nORDER BY 2 asc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2344.435930252075,
      "raw_response": "run: river -> { select: river_name, river_length, traverses; order_by: river_length asc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    }
  ]
}