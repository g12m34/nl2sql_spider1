{
  "metadata": {
    "provider": "deepseek/deepseek-chat",
    "timestamp": "2026-01-11T17:01:25.041231",
    "total": 46,
    "correct": 29,
    "errors": 10,
    "accuracy": 0.6304347826086957,
    "evaluation_type": "malloy"
  },
  "results": [
    {
      "question_id": 0,
      "db_id": "game_1",
      "question": "What are the ids of all students who played video games and sports?",
      "gold_sql": "SELECT StuID FROM Sportsinfo INTERSECT SELECT StuID FROM Plays_games",
      "predicted_malloy": "run: student -> {\n  group_by: stu_id\n  aggregate: \n    video_game_count is plays_games.count(),\n    sports_count is sports_info.count()\n} -> {\n  where: video_game_count > 0 and sports_count > 0\n  select: stu_id\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"StuID\" as \"stu_id\",\n     COUNT(DISTINCT plays_games_0.\"__distinct_key\") as \"video_game_count\",\n     COUNT(DISTINCT sports_info_0.\"__distinct_key\") as \"sports_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/game_1/game_1.sqlite', 'Student')\n  ) as base\n   LEFT JOIN (SELECT GEN_RANDOM_UUID() as \"__distinct_key\", x.*  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/game_1/game_1.sqlite', 'Plays_Games')\n  ) as x) AS plays_games_0\n    ON (base.\"StuID\")=(plays_games_0.\"StuID\")\n   LEFT JOIN (SELECT GEN_RANDOM_UUID() as \"__distinct_key\", x.*  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/game_1/game_1.sqlite', 'SportsInfo')\n  ) as x) AS sports_info_0\n    ON (base.\"StuID\")=(sports_info_0.\"StuID\")\n  GROUP BY 1\n)\nSELECT \n   base.\"stu_id\" as \"stu_id\"\nFROM __stage0 as base\nWHERE (base.\"video_game_count\">0)and(base.\"sports_count\">0)\n",
      "match": true,
      "error": null,
      "latency_ms": 3671.6549396514893,
      "raw_response": "run: student -> {\n  group_by: stu_id\n  aggregate: \n    video_game_count is plays_games.count(),\n    sports_count is sports_info.count()\n} -> {\n  where: video_game_count > 0 and sports_count > 0\n  select: stu_id\n}",
      "pred_row_count": 1,
      "gold_row_count": 1
    },
    {
      "question_id": 1,
      "db_id": "scholar",
      "question": "who published the most at chi",
      "gold_sql": "SELECT DISTINCT COUNT ( DISTINCT t2.paperid )  ,  t1.authorid FROM venue AS t3 JOIN paper AS t2 ON t3.venueid  =  t2.venueid JOIN writes AS t1 ON t1.paperid  =  t2.paperid WHERE t3.venuename  =  \"chi\" GROUP BY t1.authorid ORDER BY COUNT ( DISTINCT t2.paperid ) DESC;",
      "predicted_malloy": "run: author -> {\n  group_by: author_name\n  aggregate: chi_papers is writes.count() { where: writes.paper.venue.venue_name = 'chi' }\n} -> {\n  select: author_name, chi_papers\n  order_by: chi_papers desc\n  limit: 1\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"authorName\" as \"author_name\",\n     COUNT(CASE WHEN (venue_0.\"venueName\")='chi' THEN 1 END) as \"chi_papers\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/scholar/scholar.sqlite', 'author')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/scholar/scholar.sqlite', 'writes')\n  ) AS writes_0\n    ON (base.\"authorId\")=(writes_0.\"authorId\")\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/scholar/scholar.sqlite', 'paper')\n  ) AS paper_0\n    ON (writes_0.\"paperId\")=(paper_0.\"paperId\")\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/scholar/scholar.sqlite', 'venue')\n  ) AS venue_0\n    ON (paper_0.\"venueId\")=(venue_0.\"venueId\")\n  GROUP BY 1\n)\nSELECT \n   base.\"author_name\" as \"author_name\",\n   base.\"chi_papers\" as \"chi_papers\"\nFROM __stage0 as base\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 4187.976598739624,
      "raw_response": "run: author -> {\n  group_by: author_name\n  aggregate: chi_papers is writes.count() { where: writes.paper.venue.venue_name = 'chi' }\n} -> {\n  select: author_name, chi_papers\n  order_by: chi_papers desc\n  limit: 1\n}",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 2,
      "db_id": "movie_1",
      "question": "What are the titles and directors of the movies whose star is greater than the average stars of the movies directed by James Cameron?",
      "gold_sql": "SELECT T2.title ,  T2.director FROM Rating AS T1 JOIN Movie AS T2 ON T1.mID  =  T2.mID WHERE T1.stars  >  (SELECT avg(T1.stars) FROM Rating AS T1 JOIN Movie AS T2 ON T1.mID  =  T2.mID WHERE T2.director  =  \"James Cameron\")",
      "predicted_malloy": "run: movie -> {\n  group_by: movie_title, directed_by\n  aggregate: \n    avg_stars_for_movie is avg(rating.star_rating)\n    james_cameron_avg is movie_base { where: directed_by = 'James Cameron' }.avg(rating.star_rating)\n} -> {\n  where: avg_stars_for_movie > james_cameron_avg\n  select: movie_title, directed_by\n}",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: missing {DAY, HOUR, MINUTE, MONTH, QUARTER, SECOND, WEEK, YEAR} at 'avg' at line 5",
      "latency_ms": 4781.419992446899,
      "raw_response": "```malloy\nrun: movie -> {\n  group_by: movie_title, directed_by\n  aggregate: \n    avg_stars_for_movie is avg(rating.star_rating)\n    james_cameron_avg is movie_base { where: directed_by = 'James Cameron' }.avg(rating.star_rating)\n} -> {\n  where: avg_stars_for_movie > james_cameron_avg\n  select: movie_title, directed_by\n}\n```"
    },
    {
      "question_id": 3,
      "db_id": "manufactory_1",
      "question": "Find the name of product that is produced by both companies Creative Labs and Sony.",
      "gold_sql": "SELECT T1.name FROM products AS T1 JOIN manufacturers AS T2 ON T1.Manufacturer  =  T2.code WHERE T2.name  =  'Creative Labs' INTERSECT SELECT T1.name FROM products AS T1 JOIN manufacturers AS T2 ON T1.Manufacturer  =  T2.code WHERE T2.name  =  'Sony'",
      "predicted_malloy": "run: products -> {\n  group_by: name\n  aggregate: \n    creative_labs_count is manufacturers.count() { where: manufacturers.name = 'Creative Labs' },\n    sony_count is manufacturers.count() { where: manufacturers.name = 'Sony' }\n} -> {\n  where: creative_labs_count > 0 and sony_count > 0\n  select: name\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"Name\" as \"name\",\n     COUNT(DISTINCT CASE WHEN (manufacturers_0.\"Name\")='Creative Labs' THEN manufacturers_0.\"Code\" END) as \"creative_labs_count\",\n     COUNT(DISTINCT CASE WHEN (manufacturers_0.\"Name\")='Sony' THEN manufacturers_0.\"Code\" END) as \"sony_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/manufactory_1/manufactory_1.sqlite', 'Products')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/manufactory_1/manufactory_1.sqlite', 'Manufacturers')\n  ) AS manufacturers_0\n    ON (base.\"Manufacturer\")=(manufacturers_0.\"Code\")\n  GROUP BY 1\n)\nSELECT \n   base.\"name\" as \"name\"\nFROM __stage0 as base\nWHERE (base.\"creative_labs_count\">0)and(base.\"sony_count\">0)\n",
      "match": true,
      "error": null,
      "latency_ms": 3259.0160369873047,
      "raw_response": "run: products -> {\n  group_by: name\n  aggregate: \n    creative_labs_count is manufacturers.count() { where: manufacturers.name = 'Creative Labs' },\n    sony_count is manufacturers.count() { where: manufacturers.name = 'Sony' }\n} -> {\n  where: creative_labs_count > 0 and sony_count > 0\n  select: name\n}",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 4,
      "db_id": "ship_1",
      "question": "What are the ranks of captains that are both in the Cutter and Armed schooner classes?",
      "gold_sql": "SELECT rank FROM captain WHERE CLASS  =  'Cutter' INTERSECT SELECT rank FROM captain WHERE CLASS  =  'Armed schooner'",
      "predicted_malloy": "run: captain -> {\n  group_by: rank\n  aggregate: \n    cutter_count is count() { where: captain_class = 'Cutter' },\n    schooner_count is count() { where: captain_class = 'Armed schooner' }\n} -> {\n  where: cutter_count > 0 and schooner_count > 0\n  select: rank\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"Rank\" as \"rank\",\n     COUNT(CASE WHEN (base.\"Class\")='Cutter' THEN 1 END) as \"cutter_count\",\n     COUNT(CASE WHEN (base.\"Class\")='Armed schooner' THEN 1 END) as \"schooner_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/ship_1/ship_1.sqlite', 'captain')\n  ) as base\n  GROUP BY 1\n)\nSELECT \n   base.\"rank\" as \"rank\"\nFROM __stage0 as base\nWHERE (base.\"cutter_count\">0)and(base.\"schooner_count\">0)\n",
      "match": true,
      "error": null,
      "latency_ms": 3604.5851707458496,
      "raw_response": "run: captain -> {\n  group_by: rank\n  aggregate: \n    cutter_count is count() { where: captain_class = 'Cutter' },\n    schooner_count is count() { where: captain_class = 'Armed schooner' }\n} -> {\n  where: cutter_count > 0 and schooner_count > 0\n  select: rank\n}",
      "pred_row_count": 1,
      "gold_row_count": 1
    },
    {
      "question_id": 5,
      "db_id": "gas_company",
      "question": "Show all headquarters without a company in banking industry.",
      "gold_sql": "SELECT headquarters FROM company EXCEPT SELECT headquarters FROM company WHERE main_industry  =  'Banking'",
      "predicted_malloy": "run: company -> {\n  group_by: headquarters\n  aggregate: banking_count is count() { where: main_industry = 'Banking' }\n} -> {\n  where: banking_count = 0\n  select: headquarters\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"Headquarters\" as \"headquarters\",\n     COUNT(CASE WHEN (base.\"Main_Industry\")='Banking' THEN 1 END) as \"banking_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/gas_company/gas_company.sqlite', 'company')\n  ) as base\n  GROUP BY 1\n)\nSELECT \n   base.\"headquarters\" as \"headquarters\"\nFROM __stage0 as base\nWHERE base.\"banking_count\"=0\n",
      "match": true,
      "error": null,
      "latency_ms": 569.054365158081,
      "raw_response": "```malloy\nrun: company -> {\n  group_by: headquarters\n  aggregate: banking_count is count() { where: main_industry = 'Banking' }\n} -> {\n  where: banking_count = 0\n  select: headquarters\n}\n```",
      "pred_row_count": 2,
      "gold_row_count": 2
    },
    {
      "question_id": 6,
      "db_id": "activity_1",
      "question": "Which students participate in both Canoeing and Kayaking as their activities? Tell me their student ids.",
      "gold_sql": "SELECT T1.stuid FROM participates_in AS T1 JOIN activity AS T2 ON T2.actid  =  T2.actid WHERE T2.activity_name  =  'Canoeing' INTERSECT SELECT T1.stuid FROM participates_in AS T1 JOIN activity AS T2 ON T2.actid  =  T2.actid WHERE T2.activity_name  =  'Kayaking'",
      "predicted_malloy": "run: student -> {\n  group_by: stu_id\n  aggregate: \n    canoeing_count is participates_in.count() { where: participates_in.activity.name = 'Canoeing' },\n    kayaking_count is participates_in.count() { where: participates_in.activity.name = 'Kayaking' }\n} -> {\n  where: canoeing_count > 0 and kayaking_count > 0\n  select: stu_id\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"StuID\" as \"stu_id\",\n     COUNT(DISTINCT CASE WHEN (activity_0.\"activity_name\")='Canoeing' THEN participates_in_0.\"__distinct_key\" END) as \"canoeing_count\",\n     COUNT(DISTINCT CASE WHEN (activity_0.\"activity_name\")='Kayaking' THEN participates_in_0.\"__distinct_key\" END) as \"kayaking_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Student')\n  ) as base\n   LEFT JOIN (SELECT GEN_RANDOM_UUID() as \"__distinct_key\", x.*  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Participates_in')\n  ) as x) AS participates_in_0\n    ON (base.\"StuID\")=(participates_in_0.\"stuid\")\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Activity')\n  ) AS activity_0\n    ON (participates_in_0.\"actid\")=(activity_0.\"actid\")\n  GROUP BY 1\n)\nSELECT \n   base.\"stu_id\" as \"stu_id\"\nFROM __stage0 as base\nWHERE (base.\"canoeing_count\">0)and(base.\"kayaking_count\">0)\n",
      "match": false,
      "error": null,
      "latency_ms": 3705.8463096618652,
      "raw_response": "run: student -> {\n  group_by: stu_id\n  aggregate: \n    canoeing_count is participates_in.count() { where: participates_in.activity.name = 'Canoeing' },\n    kayaking_count is participates_in.count() { where: participates_in.activity.name = 'Kayaking' }\n} -> {\n  where: canoeing_count > 0 and kayaking_count > 0\n  select: stu_id\n}",
      "pred_row_count": 2,
      "gold_row_count": 30
    },
    {
      "question_id": 7,
      "db_id": "geo",
      "question": "which is the longest river in usa",
      "gold_sql": "SELECT river_name FROM river WHERE LENGTH  =  ( SELECT MAX ( LENGTH ) FROM river );",
      "predicted_malloy": "run: river -> { select: river_name, river_length; where: country_name = 'usa'; order_by: river_length desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"river_name\" as \"river_name\",\n   base.\"length\" as \"river_length\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'river')\n) as base\nWHERE base.\"country_name\"='usa'\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2933.7382316589355,
      "raw_response": "run: river -> { select: river_name, river_length; where: country_name = 'usa'; order_by: river_length desc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 8,
      "db_id": "customers_and_products_contacts",
      "question": "Show the names of customers who have both an order in completed status and an order in part status.",
      "gold_sql": "SELECT T1.customer_name FROM customers AS T1 JOIN customer_orders AS T2 ON T1.customer_id  =  T2.customer_id WHERE T2.order_status_code  =  'Completed' INTERSECT SELECT T1.customer_name FROM customers AS T1 JOIN customer_orders AS T2 ON T1.customer_id  =  T2.customer_id WHERE T2.order_status_code  =  'Part'",
      "predicted_malloy": "run: customers -> {\n  group_by: customer_name\n  aggregate: \n    completed_orders is customer_orders.count() { where: customer_orders.order_status_code = 'Completed' },\n    part_orders is customer_orders.count() { where: customer_orders.order_status_code = 'Part' }\n} -> {\n  where: completed_orders > 0 and part_orders > 0\n  select: customer_name\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"customer_name\" as \"customer_name\",\n     COUNT(CASE WHEN customer_orders_0.\"order_status_code\"='Completed' THEN 1 END) as \"completed_orders\",\n     COUNT(CASE WHEN customer_orders_0.\"order_status_code\"='Part' THEN 1 END) as \"part_orders\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/customers_and_products_contacts/customers_and_products_contacts.sqlite', 'Customers')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/customers_and_products_contacts/customers_and_products_contacts.sqlite', 'Customer_Orders')\n  ) AS customer_orders_0\n    ON base.\"customer_id\"=customer_orders_0.\"customer_id\"\n  GROUP BY 1\n)\nSELECT \n   base.\"customer_name\" as \"customer_name\"\nFROM __stage0 as base\nWHERE (base.\"completed_orders\">0)and(base.\"part_orders\">0)\n",
      "match": true,
      "error": null,
      "latency_ms": 4018.573999404907,
      "raw_response": "run: customers -> {\n  group_by: customer_name\n  aggregate: \n    completed_orders is customer_orders.count() { where: customer_orders.order_status_code = 'Completed' },\n    part_orders is customer_orders.count() { where: customer_orders.order_status_code = 'Part' }\n} -> {\n  where: completed_orders > 0 and part_orders > 0\n  select: customer_name\n}",
      "pred_row_count": 3,
      "gold_row_count": 3
    },
    {
      "question_id": 9,
      "db_id": "behavior_monitoring",
      "question": "What are the line 1 of addresses shared by some students and some teachers?",
      "gold_sql": "SELECT T1.line_1 FROM Addresses AS T1 JOIN Students AS T2 ON T1.address_id  =  T2.address_id INTERSECT SELECT T1.line_1 FROM Addresses AS T1 JOIN Teachers AS T2 ON T1.address_id  =  T2.address_id",
      "predicted_malloy": "run: addresses -> {\n  group_by: line_1\n  aggregate: \n    student_count is students.count(),\n    teacher_count is teachers.count()\n} -> {\n  where: student_count > 0 and teacher_count > 0\n  select: line_1\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"line_1\" as \"line_1\",\n     COUNT(DISTINCT students_0.\"student_id\") as \"student_count\",\n     COUNT(DISTINCT teachers_0.\"teacher_id\") as \"teacher_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/behavior_monitoring/behavior_monitoring.sqlite', 'Addresses')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/behavior_monitoring/behavior_monitoring.sqlite', 'Students')\n  ) AS students_0\n    ON base.\"address_id\"=students_0.\"address_id\"\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/behavior_monitoring/behavior_monitoring.sqlite', 'Teachers')\n  ) AS teachers_0\n    ON base.\"address_id\"=teachers_0.\"address_id\"\n  GROUP BY 1\n)\nSELECT \n   base.\"line_1\" as \"line_1\"\nFROM __stage0 as base\nWHERE (base.\"student_count\">0)and(base.\"teacher_count\">0)\n",
      "match": true,
      "error": null,
      "latency_ms": 3310.478925704956,
      "raw_response": "run: addresses -> {\n  group_by: line_1\n  aggregate: \n    student_count is students.count(),\n    teacher_count is teachers.count()\n} -> {\n  where: student_count > 0 and teacher_count > 0\n  select: line_1\n}",
      "pred_row_count": 7,
      "gold_row_count": 7
    },
    {
      "question_id": 20,
      "db_id": "movie_1",
      "question": "What is the average number of stars that each reviewer awards for a movie?",
      "gold_sql": "SELECT T2.name ,  avg(T1.stars) FROM Rating AS T1 JOIN Reviewer AS T2 ON T1.rID  =  T2.rID GROUP BY T2.name",
      "predicted_malloy": "run: reviewer -> {\n  group_by: reviewer_name\n  aggregate: avg_stars_awarded is rating.avg_stars\n}",
      "predicted_sql": "SELECT \n   base.\"name\" as \"reviewer_name\",\n   (AVG(rating_0.\"stars\")) as \"avg_stars_awarded\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/movie_1/movie_1.sqlite', 'Reviewer')\n) as base\n LEFT JOIN (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/movie_1/movie_1.sqlite', 'Rating')\n) AS rating_0\n  ON (base.\"rID\")=(rating_0.\"rID\")\nGROUP BY 1\nORDER BY 2 desc NULLS LAST\n",
      "match": true,
      "error": null,
      "latency_ms": 2070.0082778930664,
      "raw_response": "run: reviewer -> {\n  group_by: reviewer_name\n  aggregate: avg_stars_awarded is rating.avg_stars\n}",
      "pred_row_count": 8,
      "gold_row_count": 8
    },
    {
      "question_id": 27,
      "db_id": "geo",
      "question": "what is the tallest mountain in the united states",
      "gold_sql": "SELECT mountain_name FROM mountain WHERE mountain_altitude  =  ( SELECT MAX ( mountain_altitude ) FROM mountain );",
      "predicted_malloy": "run: mountain -> { select: mountain_name, mountain_altitude; where: country_name = 'United States'; order_by: mountain_altitude desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"mountain_name\" as \"mountain_name\",\n   base.\"mountain_altitude\" as \"mountain_altitude\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'mountain')\n) as base\nWHERE base.\"country_name\"='United States'\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2418.9889430999756,
      "raw_response": "run: mountain -> { select: mountain_name, mountain_altitude; where: country_name = 'United States'; order_by: mountain_altitude desc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 28,
      "db_id": "scholar",
      "question": "main topics of work by Brian DeRenzi",
      "gold_sql": "SELECT DISTINCT t1.keyphrasename  ,  SUM ( t3.numcitedby ) FROM paperkeyphrase AS t2 JOIN keyphrase AS t1 ON t2.keyphraseid  =  t1.keyphraseid JOIN paper AS t3 ON t3.paperid  =  t2.paperid JOIN writes AS t4 ON t4.paperid  =  t3.paperid JOIN author AS t5 ON t4.authorid  =  t5.authorid WHERE t5.authorname  =  \"Brian DeRenzi\" GROUP BY t1.keyphrasename ORDER BY SUM ( t3.numcitedby ) DESC;",
      "predicted_malloy": "run: author -> {\n  where: author_name = 'Brian DeRenzi'\n  group_by: keyphrase_name is writes.paper.paper_keyphrase.keyphrase.keyphrase_name\n  aggregate: paper_count is writes.paper.paper_keyphrase.count()\n} -> {\n  where: keyphrase_name != null\n  select: keyphrase_name, paper_count\n  order_by: paper_count desc\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     (keyphrase_0.\"keyphraseName\") as \"keyphrase_name\",\n     COUNT(DISTINCT paper_keyphrase_0.\"keyphraseId\") as \"paper_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/scholar/scholar.sqlite', 'author')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/scholar/scholar.sqlite', 'writes')\n  ) AS writes_0\n    ON (base.\"authorId\")=(writes_0.\"authorId\")\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/scholar/scholar.sqlite', 'paper')\n  ) AS paper_0\n    ON (writes_0.\"paperId\")=(paper_0.\"paperId\")\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/scholar/scholar.sqlite', 'paperKeyphrase')\n  ) AS paper_keyphrase_0\n    ON (paper_0.\"paperId\")=(paper_keyphrase_0.\"paperId\")\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/scholar/scholar.sqlite', 'keyphrase')\n  ) AS keyphrase_0\n    ON (paper_keyphrase_0.\"keyphraseId\")=(keyphrase_0.\"keyphraseId\")\n  WHERE (base.\"authorName\")='Brian DeRenzi'\n  GROUP BY 1\n)\nSELECT \n   base.\"keyphrase_name\" as \"keyphrase_name\",\n   base.\"paper_count\" as \"paper_count\"\nFROM __stage0 as base\nWHERE base.\"keyphrase_name\" IS NOT NULL\nORDER BY 2 desc NULLS LAST\n",
      "match": true,
      "error": null,
      "latency_ms": 3852.7579307556152,
      "raw_response": "run: author -> {\n  where: author_name = 'Brian DeRenzi'\n  group_by: keyphrase_name is writes.paper.paper_keyphrase.keyphrase.keyphrase_name\n  aggregate: paper_count is writes.paper.paper_keyphrase.count()\n} -> {\n  where: keyphrase_name != null\n  select: keyphrase_name, paper_count\n  order_by: paper_count desc\n}",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 32,
      "db_id": "geo",
      "question": "what is the lowest point of all states through which the mississippi river runs through",
      "gold_sql": "SELECT lowest_point FROM highlow WHERE state_name IN ( SELECT traverse FROM river WHERE river_name  =  \"mississippi\" ) ORDER BY lowest_elevation LIMIT 1;",
      "predicted_malloy": "run: river -> {\n  where: river_name = 'mississippi'\n  group_by: traverse\n} -> {\n  group_by: state_val.highlow.lowest_point\n}",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: 'state_val' is not defined at line 5",
      "latency_ms": 2598.092555999756,
      "raw_response": "```malloy\nrun: river -> {\n  where: river_name = 'mississippi'\n  group_by: traverse\n} -> {\n  group_by: state_val.highlow.lowest_point\n}\n```"
    },
    {
      "question_id": 35,
      "db_id": "geo",
      "question": "what is the largest capital",
      "gold_sql": "SELECT city_name FROM city WHERE population  =  ( SELECT MAX ( t1.population ) FROM state AS t2 JOIN city AS t1 ON t2.capital  =  t1.city_name );",
      "predicted_malloy": "run: state_val -> { select: capital, state_area; order_by: state_area desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"capital\" as \"capital\",\n   base.\"area\" as \"state_area\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'state')\n) as base\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2306.828260421753,
      "raw_response": "```malloy\nrun: state_val -> { select: capital, state_area; order_by: state_area desc; limit: 1 }\n```",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 40,
      "db_id": "scholar",
      "question": "What is the most cited paper by ohad shamir ?",
      "gold_sql": "SELECT DISTINCT t4.citedpaperid  ,  COUNT ( t4.citedpaperid ) FROM paper AS t3 JOIN cite AS t4 ON t3.paperid  =  t4.citedpaperid JOIN writes AS t2 ON t2.paperid  =  t3.paperid JOIN author AS t1 ON t2.authorid  =  t1.authorid WHERE t1.authorname  =  \"ohad shamir\" GROUP BY t4.citedpaperid ORDER BY COUNT ( t4.citedpaperid ) DESC;",
      "predicted_malloy": "run: author -> {\n  where: author_name = 'ohad shamir'\n  group_by: writes.paper.title\n  aggregate: citation_count is writes.paper.num_cited_by\n} -> {\n  order_by: citation_count desc\n  limit: 1\n  select: title, citation_count\n}",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: Cannot use a scalar field in an aggregate operation, did you mean to use a group_by or select operation instead? at line 4",
      "latency_ms": 3182.297945022583,
      "raw_response": "run: author -> {\n  where: author_name = 'ohad shamir'\n  group_by: writes.paper.title\n  aggregate: citation_count is writes.paper.num_cited_by\n} -> {\n  order_by: citation_count desc\n  limit: 1\n  select: title, citation_count\n}"
    },
    {
      "question_id": 46,
      "db_id": "geo",
      "question": "what state has the sparsest population density",
      "gold_sql": "SELECT state_name FROM state WHERE density  =  ( SELECT MIN ( density ) FROM state );",
      "predicted_malloy": "run: state_val -> { select: state_name, state_density; order_by: state_density asc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"state_name\" as \"state_name\",\n   base.\"density\" as \"state_density\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'state')\n) as base\nORDER BY 2 asc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2345.101833343506,
      "raw_response": "run: state_val -> { select: state_name, state_density; order_by: state_density asc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 47,
      "db_id": "activity_1",
      "question": "What is the first and last name of the faculty members who participated in at least one activity? For each of them, also show the number of activities they participated in.",
      "gold_sql": "SELECT  T1.fname ,  T1.lname ,  count(*) ,  T1.FacID FROM Faculty AS T1 JOIN Faculty_participates_in AS T2 ON T1.facID  =  T2.facID GROUP BY T1.FacID",
      "predicted_malloy": "run: faculty -> {\n  group_by: first_name, last_name\n  aggregate: activities_participated_in is faculty_participates_in.count()\n} -> {\n  where: activities_participated_in > 0\n  select: first_name, last_name, activities_participated_in\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"Fname\" as \"first_name\",\n     base.\"Lname\" as \"last_name\",\n     COUNT(DISTINCT faculty_participates_in_0.\"__distinct_key\") as \"activities_participated_in\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Faculty')\n  ) as base\n   LEFT JOIN (SELECT GEN_RANDOM_UUID() as \"__distinct_key\", x.*  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Faculty_Participates_in')\n  ) as x) AS faculty_participates_in_0\n    ON (base.\"FacID\")=(faculty_participates_in_0.\"FacID\")\n  GROUP BY 1,2\n)\nSELECT \n   base.\"first_name\" as \"first_name\",\n   base.\"last_name\" as \"last_name\",\n   base.\"activities_participated_in\" as \"activities_participated_in\"\nFROM __stage0 as base\nWHERE base.\"activities_participated_in\">0\n",
      "match": false,
      "error": null,
      "latency_ms": 3420.459985733032,
      "raw_response": "run: faculty -> {\n  group_by: first_name, last_name\n  aggregate: activities_participated_in is faculty_participates_in.count()\n} -> {\n  where: activities_participated_in > 0\n  select: first_name, last_name, activities_participated_in\n}",
      "pred_row_count": 18,
      "gold_row_count": 18
    },
    {
      "question_id": 55,
      "db_id": "geo",
      "question": "what is the biggest state",
      "gold_sql": "SELECT state_name FROM state WHERE area  =  ( SELECT MAX ( area ) FROM state );",
      "predicted_malloy": "run: state_val -> { select: state_name, state_area; order_by: state_area desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"state_name\" as \"state_name\",\n   base.\"area\" as \"state_area\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'state')\n) as base\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2061.629056930542,
      "raw_response": "run: state_val -> { select: state_name, state_area; order_by: state_area desc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 56,
      "db_id": "scholar",
      "question": "count of ACL papers by author",
      "gold_sql": "SELECT DISTINCT COUNT ( t2.paperid )  ,  t1.authorid FROM venue AS t3 JOIN paper AS t2 ON t3.venueid  =  t2.venueid JOIN writes AS t1 ON t1.paperid  =  t2.paperid WHERE t3.venuename  =  \"ACL\" GROUP BY t1.authorid;",
      "predicted_malloy": "run: author -> {\n  group_by: author_name\n  aggregate: acl_paper_count is writes.count() { where: writes.paper.venue.venue_name = 'ACL' }\n} -> {\n  where: acl_paper_count > 0\n  select: author_name, acl_paper_count\n  order_by: acl_paper_count desc\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"authorName\" as \"author_name\",\n     COUNT(CASE WHEN (venue_0.\"venueName\")='ACL' THEN 1 END) as \"acl_paper_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/scholar/scholar.sqlite', 'author')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/scholar/scholar.sqlite', 'writes')\n  ) AS writes_0\n    ON (base.\"authorId\")=(writes_0.\"authorId\")\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/scholar/scholar.sqlite', 'paper')\n  ) AS paper_0\n    ON (writes_0.\"paperId\")=(paper_0.\"paperId\")\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/scholar/scholar.sqlite', 'venue')\n  ) AS venue_0\n    ON (paper_0.\"venueId\")=(venue_0.\"venueId\")\n  GROUP BY 1\n)\nSELECT \n   base.\"author_name\" as \"author_name\",\n   base.\"acl_paper_count\" as \"acl_paper_count\"\nFROM __stage0 as base\nWHERE base.\"acl_paper_count\">0\nORDER BY 2 desc NULLS LAST\n",
      "match": true,
      "error": null,
      "latency_ms": 3760.5457305908203,
      "raw_response": "run: author -> {\n  group_by: author_name\n  aggregate: acl_paper_count is writes.count() { where: writes.paper.venue.venue_name = 'ACL' }\n} -> {\n  where: acl_paper_count > 0\n  select: author_name, acl_paper_count\n  order_by: acl_paper_count desc\n}",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 58,
      "db_id": "geo",
      "question": "what rivers flow through the state with the largest population",
      "gold_sql": "SELECT river_name FROM river WHERE traverse IN ( SELECT state_name FROM state WHERE population  =  ( SELECT MAX ( population ) FROM state ) );",
      "predicted_malloy": "run: river -> {\n  group_by: river_name\n  aggregate: state_pop is state_val.total_population\n} -> {\n  order_by: state_pop desc\n  limit: 1\n  select: river_name\n}",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: Unknown field state_pop in output space at line 5",
      "latency_ms": 2918.7862873077393,
      "raw_response": "run: river -> {\n  group_by: river_name\n  aggregate: state_pop is state_val.total_population\n} -> {\n  order_by: state_pop desc\n  limit: 1\n  select: river_name\n}"
    },
    {
      "question_id": 59,
      "db_id": "geo",
      "question": "where is the highest mountain of the united states",
      "gold_sql": "SELECT state_name FROM mountain WHERE mountain_altitude  =  ( SELECT MAX ( mountain_altitude ) FROM mountain );",
      "predicted_malloy": "run: mountain -> { select: mountain_name, mountain_altitude, state_name; order_by: mountain_altitude desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"mountain_name\" as \"mountain_name\",\n   base.\"mountain_altitude\" as \"mountain_altitude\",\n   base.\"state_name\" as \"state_name\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'mountain')\n) as base\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2224.134922027588,
      "raw_response": "run: mountain -> { select: mountain_name, mountain_altitude, state_name; order_by: mountain_altitude desc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 63,
      "db_id": "movie_1",
      "question": "What are the movie titles with the highest average rating and what are those ratings?",
      "gold_sql": "SELECT T2.title ,  avg(T1.stars) FROM Rating AS T1 JOIN Movie AS T2 ON T1.mID  =  T2.mID GROUP BY T1.mID ORDER BY avg(T1.stars) DESC LIMIT 1",
      "predicted_malloy": "run: movie -> {\n  group_by: movie_title\n  aggregate: avg_rating is rating.avg_stars\n} -> {\n  order_by: avg_rating desc\n  select: movie_title, avg_rating\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"title\" as \"movie_title\",\n     (AVG(rating_0.\"stars\")) as \"avg_rating\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/movie_1/movie_1.sqlite', 'Movie')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/movie_1/movie_1.sqlite', 'Rating')\n  ) AS rating_0\n    ON (base.\"mID\")=(rating_0.\"mID\")\n  GROUP BY 1\n)\nSELECT \n   base.\"movie_title\" as \"movie_title\",\n   base.\"avg_rating\" as \"avg_rating\"\nFROM __stage0 as base\nORDER BY 2 desc NULLS LAST\n",
      "match": false,
      "error": null,
      "latency_ms": 2881.5324306488037,
      "raw_response": "run: movie -> {\n  group_by: movie_title\n  aggregate: avg_rating is rating.avg_stars\n} -> {\n  order_by: avg_rating desc\n  select: movie_title, avg_rating\n}",
      "pred_row_count": 8,
      "gold_row_count": 1
    },
    {
      "question_id": 64,
      "db_id": "geo",
      "question": "what is the lowest point of the state with the largest area",
      "gold_sql": "SELECT t2.lowest_point FROM state AS t1 JOIN highlow AS t2 ON t1.state_name  =  t2.state_name WHERE t1.state_name IN ( SELECT state_name FROM state WHERE area  =  ( SELECT MAX ( area ) FROM state ) );",
      "predicted_malloy": "run: state_val -> { select: state_name, state_area; order_by: state_area desc; limit: 1 } -> { join_one: highlow is highlow_base on state_name = highlow.state_name; select: highlow.lowest_point }",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: Joins in queries are deprecated, move into an `extend:` block. at line 1",
      "latency_ms": 456.48646354675293,
      "raw_response": "run: state_val -> { select: state_name, state_area; order_by: state_area desc; limit: 1 } -> { join_one: highlow is highlow_base on state_name = highlow.state_name; select: highlow.lowest_point }"
    },
    {
      "question_id": 65,
      "db_id": "geo",
      "question": "how large is the largest city in alaska",
      "gold_sql": "SELECT population FROM city WHERE population  =  ( SELECT MAX ( population ) FROM city WHERE state_name  =  \"alaska\" ) AND state_name  =  \"alaska\";",
      "predicted_malloy": "run: city -> { where: state_name = 'Alaska'; select: city_name, population; order_by: population desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"city_name\" as \"city_name\",\n   base.\"population\" as \"population\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'city')\n) as base\nWHERE base.\"state_name\"='Alaska'\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2260.8721256256104,
      "raw_response": "```malloy\nrun: city -> { where: state_name = 'Alaska'; select: city_name, population; order_by: population desc; limit: 1 }\n```",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 81,
      "db_id": "geo",
      "question": "what states border the state with the smallest area",
      "gold_sql": "SELECT border FROM border_info WHERE state_name  =  ( SELECT state_name FROM state WHERE area  =  ( SELECT MIN ( area ) FROM state ) );",
      "predicted_malloy": "run: state_val -> {\n  group_by: state_name, state_area\n  aggregate: border_count is border_info_state_name.count()\n} -> {\n  where: border_count > 0\n  select: state_name, state_area\n  order_by: state_area asc\n  limit: 1\n} -> {\n  select: state_name\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"state_name\" as \"state_name\",\n     base.\"area\" as \"state_area\",\n     COUNT(1) as \"border_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'state')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'border_info')\n  ) AS border_info_state_name_0\n    ON base.\"state_name\"=border_info_state_name_0.\"state_name\"\n  GROUP BY 1,2\n)\n, __stage1 AS (\n  SELECT \n     base.\"state_name\" as \"state_name\",\n     base.\"state_area\" as \"state_area\"\n  FROM __stage0 as base\n  WHERE base.\"border_count\">0\n  ORDER BY 2 asc NULLS LAST\n  LIMIT 1\n)\nSELECT \n   base.\"state_name\" as \"state_name\"\nFROM __stage1 as base\n",
      "match": true,
      "error": null,
      "latency_ms": 3412.3575687408447,
      "raw_response": "```malloy\nrun: state_val -> {\n  group_by: state_name, state_area\n  aggregate: border_count is border_info_state_name.count()\n} -> {\n  where: border_count > 0\n  select: state_name, state_area\n  order_by: state_area asc\n  limit: 1\n} -> {\n  select: state_name\n}\n```",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 91,
      "db_id": "movie_1",
      "question": "What are the ids of all moviest hat have not been reviewed by Britanny Harris?",
      "gold_sql": "SELECT mID FROM Rating EXCEPT SELECT T1.mID FROM Rating AS T1 JOIN Reviewer AS T2 ON T1.rID  =  T2.rID WHERE T2.name  =  \"Brittany Harris\"",
      "predicted_malloy": "run: movie -> {\n  group_by: m_id\n  aggregate: \n    brittany_ratings is rating.count() { where: rating.reviewer.reviewer_name = 'Brittany Harris' }\n} -> {\n  where: brittany_ratings = 0\n  select: m_id\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"mID\" as \"m_id\",\n     COUNT(DISTINCT CASE WHEN (reviewer_0.\"name\")='Brittany Harris' THEN rating_0.\"__distinct_key\" END) as \"brittany_ratings\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/movie_1/movie_1.sqlite', 'Movie')\n  ) as base\n   LEFT JOIN (SELECT GEN_RANDOM_UUID() as \"__distinct_key\", x.*  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/movie_1/movie_1.sqlite', 'Rating')\n  ) as x) AS rating_0\n    ON (base.\"mID\")=(rating_0.\"mID\")\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/movie_1/movie_1.sqlite', 'Reviewer')\n  ) AS reviewer_0\n    ON (rating_0.\"rID\")=(reviewer_0.\"rID\")\n  GROUP BY 1\n)\nSELECT \n   base.\"m_id\" as \"m_id\"\nFROM __stage0 as base\nWHERE base.\"brittany_ratings\"=0\n",
      "match": false,
      "error": null,
      "latency_ms": 3238.976001739502,
      "raw_response": "run: movie -> {\n  group_by: m_id\n  aggregate: \n    brittany_ratings is rating.count() { where: rating.reviewer.reviewer_name = 'Brittany Harris' }\n} -> {\n  where: brittany_ratings = 0\n  select: m_id\n}",
      "pred_row_count": 6,
      "gold_row_count": 4
    },
    {
      "question_id": 106,
      "db_id": "game_1",
      "question": "Show student ids who are on scholarship and have major 600.",
      "gold_sql": "SELECT StuID FROM Student WHERE major  =  600 INTERSECT SELECT StuID FROM Sportsinfo WHERE onscholarship  =  'Y'",
      "predicted_malloy": "run: student -> {\n  where: sports_info.on_scholarship = 'Y' and major = 600\n  select: stu_id\n}",
      "predicted_sql": "SELECT \n   base.\"StuID\" as \"stu_id\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/game_1/game_1.sqlite', 'Student')\n) as base\n LEFT JOIN (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/game_1/game_1.sqlite', 'SportsInfo')\n) AS sports_info_0\n  ON (base.\"StuID\")=(sports_info_0.\"StuID\")\nWHERE ((sports_info_0.\"OnScholarship\")='Y')and((base.\"Major\")=600)\n",
      "match": true,
      "error": null,
      "latency_ms": 3940.221071243286,
      "raw_response": "```malloy\nrun: student -> {\n  where: sports_info.on_scholarship = 'Y' and major = 600\n  select: stu_id\n}\n```",
      "pred_row_count": 4,
      "gold_row_count": 4
    },
    {
      "question_id": 110,
      "db_id": "movie_1",
      "question": "What is the name of the movie that has been reviewed the most?",
      "gold_sql": "SELECT T2.title ,  T1.mID FROM Rating AS T1 JOIN Movie AS T2 ON T1.mID  =  T2.mID GROUP BY T1.mID ORDER BY count(*) DESC LIMIT 1",
      "predicted_malloy": "run: movie -> { group_by: movie_title; aggregate: review_count is rating.count() } -> { order_by: review_count desc; limit: 1; select: movie_title }",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: Unknown field review_count in output space at line 1",
      "latency_ms": 2632.5008869171143,
      "raw_response": "run: movie -> { group_by: movie_title; aggregate: review_count is rating.count() } -> { order_by: review_count desc; limit: 1; select: movie_title }"
    },
    {
      "question_id": 111,
      "db_id": "geo",
      "question": "what is the capital of the state with the most inhabitants",
      "gold_sql": "SELECT capital FROM state WHERE population  =  ( SELECT MAX ( population ) FROM state );",
      "predicted_malloy": "run: state_val -> { select: capital, state_population; order_by: state_population desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"capital\" as \"capital\",\n   base.\"population\" as \"state_population\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'state')\n) as base\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2441.365957260132,
      "raw_response": "```malloy\nrun: state_val -> { select: capital, state_population; order_by: state_population desc; limit: 1 }\n```",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 114,
      "db_id": "movie_1",
      "question": "Return all reviewer names and movie names together in a single list.",
      "gold_sql": "SELECT name FROM Reviewer UNION SELECT title FROM Movie",
      "predicted_malloy": "run: reviewer -> { select: reviewer_name } -> { project: name is reviewer_name } + movie -> { select: movie_title } -> { project: name is movie_title }",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: project: keyword is deprecated, use select: at line 1",
      "latency_ms": 2623.9824295043945,
      "raw_response": "run: reviewer -> { select: reviewer_name } -> { project: name is reviewer_name } + movie -> { select: movie_title } -> { project: name is movie_title }"
    },
    {
      "question_id": 117,
      "db_id": "scholar",
      "question": "What is the most cited paper of ohad shamir ?",
      "gold_sql": "SELECT DISTINCT t4.citedpaperid  ,  COUNT ( t4.citedpaperid ) FROM paper AS t3 JOIN cite AS t4 ON t3.paperid  =  t4.citedpaperid JOIN writes AS t2 ON t2.paperid  =  t3.paperid JOIN author AS t1 ON t2.authorid  =  t1.authorid WHERE t1.authorname  =  \"ohad shamir\" GROUP BY t4.citedpaperid ORDER BY COUNT ( t4.citedpaperid ) DESC;",
      "predicted_malloy": "run: author -> {\n  where: author_name = 'ohad shamir'\n  group_by: writes.paper.title\n  aggregate: citation_count is writes.paper.num_cited_by\n} -> {\n  order_by: citation_count desc\n  limit: 1\n  select: title, citation_count\n}",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: Cannot use a scalar field in an aggregate operation, did you mean to use a group_by or select operation instead? at line 4",
      "latency_ms": 3520.338535308838,
      "raw_response": "run: author -> {\n  where: author_name = 'ohad shamir'\n  group_by: writes.paper.title\n  aggregate: citation_count is writes.paper.num_cited_by\n} -> {\n  order_by: citation_count desc\n  limit: 1\n  select: title, citation_count\n}"
    },
    {
      "question_id": 124,
      "db_id": "behavior_monitoring",
      "question": "Find the last names of teachers who are not involved in any detention.",
      "gold_sql": "SELECT last_name FROM Teachers EXCEPT SELECT T1.last_name FROM Teachers AS T1 JOIN Detention AS T2 ON T1.teacher_id  =  T2.teacher_id",
      "predicted_malloy": "run: teachers -> {\n  group_by: last_name\n  aggregate: detention_count is detention.count()\n} -> {\n  where: detention_count = 0\n  select: last_name\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"last_name\" as \"last_name\",\n     COUNT(1) as \"detention_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/behavior_monitoring/behavior_monitoring.sqlite', 'Teachers')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/behavior_monitoring/behavior_monitoring.sqlite', 'Detention')\n  ) AS detention_0\n    ON base.\"teacher_id\"=detention_0.\"teacher_id\"\n  GROUP BY 1\n)\nSELECT \n   base.\"last_name\" as \"last_name\"\nFROM __stage0 as base\nWHERE base.\"detention_count\"=0\n",
      "match": false,
      "error": null,
      "latency_ms": 389.1913890838623,
      "raw_response": "run: teachers -> {\n  group_by: last_name\n  aggregate: detention_count is detention.count()\n} -> {\n  where: detention_count = 0\n  select: last_name\n}",
      "pred_row_count": 0,
      "gold_row_count": 5
    },
    {
      "question_id": 133,
      "db_id": "activity_1",
      "question": "Show the ids of all the faculty members who participate in an activity and advise a student.",
      "gold_sql": "SELECT FacID FROM Faculty_participates_in INTERSECT SELECT advisor FROM Student",
      "predicted_malloy": "run: faculty -> {\n  group_by: fac_id\n  aggregate: \n    activity_count is faculty_participates_in.count(),\n    student_count is student.count()\n} -> {\n  where: activity_count > 0 and student_count > 0\n  select: fac_id\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"FacID\" as \"fac_id\",\n     COUNT(DISTINCT faculty_participates_in_0.\"__distinct_key\") as \"activity_count\",\n     COUNT(DISTINCT student_0.\"StuID\") as \"student_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Faculty')\n  ) as base\n   LEFT JOIN (SELECT GEN_RANDOM_UUID() as \"__distinct_key\", x.*  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Faculty_Participates_in')\n  ) as x) AS faculty_participates_in_0\n    ON (base.\"FacID\")=(faculty_participates_in_0.\"FacID\")\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Student')\n  ) AS student_0\n    ON (base.\"FacID\")=(student_0.\"Advisor\")\n  GROUP BY 1\n)\nSELECT \n   base.\"fac_id\" as \"fac_id\"\nFROM __stage0 as base\nWHERE (base.\"activity_count\">0)and(base.\"student_count\">0)\n",
      "match": true,
      "error": null,
      "latency_ms": 3428.7099838256836,
      "raw_response": "run: faculty -> {\n  group_by: fac_id\n  aggregate: \n    activity_count is faculty_participates_in.count(),\n    student_count is student.count()\n} -> {\n  where: activity_count > 0 and student_count > 0\n  select: fac_id\n}",
      "pred_row_count": 7,
      "gold_row_count": 7
    },
    {
      "question_id": 136,
      "db_id": "geo",
      "question": "what state has the longest river",
      "gold_sql": "SELECT DISTINCT traverse FROM river WHERE LENGTH  =  ( SELECT MAX ( DISTINCT LENGTH ) FROM river );",
      "predicted_malloy": "run: river -> { select: river_name, river_length, state_val.state_name; order_by: river_length desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"river_name\" as \"river_name\",\n   base.\"length\" as \"river_length\",\n   state_val_0.\"state_name\" as \"state_name\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'river')\n) as base\n LEFT JOIN (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'state')\n) AS state_val_0\n  ON base.\"traverse\"=state_val_0.\"state_name\"\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2218.486547470093,
      "raw_response": "run: river -> { select: river_name, river_length, state_val.state_name; order_by: river_length desc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 144,
      "db_id": "gas_company",
      "question": "What are the headquarters without companies that are in the banking industry?",
      "gold_sql": "SELECT headquarters FROM company EXCEPT SELECT headquarters FROM company WHERE main_industry  =  'Banking'",
      "predicted_malloy": "run: company -> {\n  group_by: headquarters\n  aggregate: banking_companies is count() { where: main_industry = 'Banking' }\n} -> {\n  where: banking_companies = 0\n  select: headquarters\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"Headquarters\" as \"headquarters\",\n     COUNT(CASE WHEN (base.\"Main_Industry\")='Banking' THEN 1 END) as \"banking_companies\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/gas_company/gas_company.sqlite', 'company')\n  ) as base\n  GROUP BY 1\n)\nSELECT \n   base.\"headquarters\" as \"headquarters\"\nFROM __stage0 as base\nWHERE base.\"banking_companies\"=0\n",
      "match": true,
      "error": null,
      "latency_ms": 2519.2553997039795,
      "raw_response": "run: company -> {\n  group_by: headquarters\n  aggregate: banking_companies is count() { where: main_industry = 'Banking' }\n} -> {\n  where: banking_companies = 0\n  select: headquarters\n}",
      "pred_row_count": 2,
      "gold_row_count": 2
    },
    {
      "question_id": 148,
      "db_id": "geo",
      "question": "which state is the smallest",
      "gold_sql": "SELECT state_name FROM state WHERE area  =  ( SELECT MIN ( area ) FROM state );",
      "predicted_malloy": "run: state_val -> { select: state_name, state_area; order_by: state_area asc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"state_name\" as \"state_name\",\n   base.\"area\" as \"state_area\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'state')\n) as base\nORDER BY 2 asc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2312.455892562866,
      "raw_response": "```malloy\nrun: state_val -> { select: state_name, state_area; order_by: state_area asc; limit: 1 }\n```",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 150,
      "db_id": "movie_1",
      "question": "For each director, what are the titles and ratings for all the movies they reviewed?",
      "gold_sql": "SELECT T2.title ,  T1.stars ,  T2.director ,  max(T1.stars) FROM Rating AS T1 JOIN Movie AS T2 ON T1.mID  =  T2.mID WHERE director != \"null\" GROUP BY director",
      "predicted_malloy": "run: reviewer -> {\n  group_by: \n    reviewer_name,\n    movie.directed_by\n  aggregate: \n    movie_titles is movie.movie_title,\n    ratings is movie.rating.star_rating\n} -> {\n  where: movie.directed_by = reviewer_name\n  select: \n    director is reviewer_name,\n    movie_titles,\n    ratings\n}",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: 'movie' is not defined at line 4",
      "latency_ms": 3346.6129302978516,
      "raw_response": "run: reviewer -> {\n  group_by: \n    reviewer_name,\n    movie.directed_by\n  aggregate: \n    movie_titles is movie.movie_title,\n    ratings is movie.rating.star_rating\n} -> {\n  where: movie.directed_by = reviewer_name\n  select: \n    director is reviewer_name,\n    movie_titles,\n    ratings\n}"
    },
    {
      "question_id": 152,
      "db_id": "activity_1",
      "question": "Show ids for the faculty members who don't advise any student.",
      "gold_sql": "SELECT FacID FROM Faculty EXCEPT SELECT advisor FROM Student",
      "predicted_malloy": "run: faculty -> {\n  group_by: fac_id\n  aggregate: advised_students is student.count()\n} -> {\n  where: advised_students = 0\n  select: fac_id\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"FacID\" as \"fac_id\",\n     COUNT(1) as \"advised_students\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Faculty')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Student')\n  ) AS student_0\n    ON (base.\"FacID\")=(student_0.\"Advisor\")\n  GROUP BY 1\n)\nSELECT \n   base.\"fac_id\" as \"fac_id\"\nFROM __stage0 as base\nWHERE base.\"advised_students\"=0\n",
      "match": false,
      "error": null,
      "latency_ms": 2550.191640853882,
      "raw_response": "run: faculty -> {\n  group_by: fac_id\n  aggregate: advised_students is student.count()\n} -> {\n  where: advised_students = 0\n  select: fac_id\n}",
      "pred_row_count": 0,
      "gold_row_count": 40
    },
    {
      "question_id": 162,
      "db_id": "activity_1",
      "question": "What are the first names of the professors who do not play Canoeing or Kayaking as activities?",
      "gold_sql": "SELECT lname FROM faculty WHERE rank  =  'Professor' EXCEPT SELECT DISTINCT T1.lname FROM Faculty AS T1 JOIN Faculty_participates_in AS T2 ON T1.facID  =  T2.facID JOIN activity AS T3 ON T2.actid  =  T2.actid WHERE T3.activity_name  =  'Canoeing' OR T3.activity_name  =  'Kayaking'",
      "predicted_malloy": "run: faculty -> {\n  group_by: first_name\n  aggregate: \n    canoeing_count is faculty_participates_in.count() { where: faculty_participates_in.activity.name = 'Canoeing' }\n    kayaking_count is faculty_participates_in.count() { where: faculty_participates_in.activity.name = 'Kayaking' }\n} -> {\n  where: canoeing_count = 0 and kayaking_count = 0\n  select: first_name\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"Fname\" as \"first_name\",\n     COUNT(DISTINCT CASE WHEN (activity_0.\"activity_name\")='Canoeing' THEN faculty_participates_in_0.\"__distinct_key\" END) as \"canoeing_count\",\n     COUNT(DISTINCT CASE WHEN (activity_0.\"activity_name\")='Kayaking' THEN faculty_participates_in_0.\"__distinct_key\" END) as \"kayaking_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Faculty')\n  ) as base\n   LEFT JOIN (SELECT GEN_RANDOM_UUID() as \"__distinct_key\", x.*  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Faculty_Participates_in')\n  ) as x) AS faculty_participates_in_0\n    ON (base.\"FacID\")=(faculty_participates_in_0.\"FacID\")\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/activity_1/activity_1.sqlite', 'Activity')\n  ) AS activity_0\n    ON (faculty_participates_in_0.\"actid\")=(activity_0.\"actid\")\n  GROUP BY 1\n)\nSELECT \n   base.\"first_name\" as \"first_name\"\nFROM __stage0 as base\nWHERE (base.\"canoeing_count\"=0)and(base.\"kayaking_count\"=0)\n",
      "match": false,
      "error": null,
      "latency_ms": 4200.314044952393,
      "raw_response": "run: faculty -> {\n  group_by: first_name\n  aggregate: \n    canoeing_count is faculty_participates_in.count() { where: faculty_participates_in.activity.name = 'Canoeing' }\n    kayaking_count is faculty_participates_in.count() { where: faculty_participates_in.activity.name = 'Kayaking' }\n} -> {\n  where: canoeing_count = 0 and kayaking_count = 0\n  select: first_name\n}",
      "pred_row_count": 48,
      "gold_row_count": 22
    },
    {
      "question_id": 180,
      "db_id": "geo",
      "question": "what is the capital of the state with the largest population",
      "gold_sql": "SELECT capital FROM state WHERE population  =  ( SELECT MAX ( population ) FROM state );",
      "predicted_malloy": "run: state_val -> { select: capital, state_population; order_by: state_population desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"capital\" as \"capital\",\n   base.\"population\" as \"state_population\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'state')\n) as base\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2667.8223609924316,
      "raw_response": "run: state_val -> { select: capital, state_population; order_by: state_population desc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 185,
      "db_id": "geo",
      "question": "what is the largest city in wyoming",
      "gold_sql": "SELECT city_name FROM city WHERE population  =  ( SELECT MAX ( population ) FROM city WHERE state_name  =  \"wyoming\" ) AND state_name  =  \"wyoming\";",
      "predicted_malloy": "run: city -> { where: state_name = 'wyoming'; select: city_name, population; order_by: population desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"city_name\" as \"city_name\",\n   base.\"population\" as \"population\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'city')\n) as base\nWHERE base.\"state_name\"='wyoming'\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2519.334077835083,
      "raw_response": "run: city -> { where: state_name = 'wyoming'; select: city_name, population; order_by: population desc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 189,
      "db_id": "geo",
      "question": "which state has the most population",
      "gold_sql": "SELECT state_name FROM state WHERE population  =  ( SELECT MAX ( population ) FROM state );",
      "predicted_malloy": "run: state_val -> { select: state_name, state_population; order_by: state_population desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"state_name\" as \"state_name\",\n   base.\"population\" as \"state_population\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'state')\n) as base\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": -195.01543045043945,
      "raw_response": "run: state_val -> { select: state_name, state_population; order_by: state_population desc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 197,
      "db_id": "geo",
      "question": "what is the most populous state in the us",
      "gold_sql": "SELECT state_name FROM state WHERE population  =  ( SELECT MAX ( population ) FROM state );",
      "predicted_malloy": "run: state_val -> { select: state_name, state_population; order_by: state_population desc; limit: 1 }",
      "predicted_sql": "SELECT \n   base.\"state_name\" as \"state_name\",\n   base.\"population\" as \"state_population\"\nFROM (\n  SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/geo/geo.sqlite', 'state')\n) as base\nORDER BY 2 desc NULLS LAST\nLIMIT 1\n",
      "match": true,
      "error": null,
      "latency_ms": 2451.2033462524414,
      "raw_response": "run: state_val -> { select: state_name, state_population; order_by: state_population desc; limit: 1 }",
      "pred_row_count": 0,
      "gold_row_count": 0
    },
    {
      "question_id": 198,
      "db_id": "ship_1",
      "question": "What are the names of ships that are commanded by both captains with the rank of Midshipman and captains with the rank of Lieutenant?",
      "gold_sql": "SELECT t1.name FROM ship AS t1 JOIN captain AS t2 ON t1.ship_id  =  t2.ship_id WHERE t2.rank  =  'Midshipman' INTERSECT SELECT t1.name FROM ship AS t1 JOIN captain AS t2 ON t1.ship_id  =  t2.ship_id WHERE t2.rank  =  'Lieutenant'",
      "predicted_malloy": "run: ship -> {\n  group_by: ship_name\n  aggregate: \n    midshipman_count is captain.count() { where: captain.rank = 'Midshipman' },\n    lieutenant_count is captain.count() { where: captain.rank = 'Lieutenant' }\n} -> {\n  where: midshipman_count > 0 and lieutenant_count > 0\n  select: ship_name\n}",
      "predicted_sql": "WITH __stage0 AS (\n  SELECT \n     base.\"Name\" as \"ship_name\",\n     COUNT(CASE WHEN (captain_0.\"Rank\")='Midshipman' THEN 1 END) as \"midshipman_count\",\n     COUNT(CASE WHEN (captain_0.\"Rank\")='Lieutenant' THEN 1 END) as \"lieutenant_count\"\n  FROM (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/ship_1/ship_1.sqlite', 'Ship')\n  ) as base\n   LEFT JOIN (\n    SELECT * FROM sqlite_scan('/workspace/spider_db/spider/database/ship_1/ship_1.sqlite', 'captain')\n  ) AS captain_0\n    ON (base.\"Ship_ID\")=(captain_0.\"Ship_ID\")\n  GROUP BY 1\n)\nSELECT \n   base.\"ship_name\" as \"ship_name\"\nFROM __stage0 as base\nWHERE (base.\"midshipman_count\">0)and(base.\"lieutenant_count\">0)\n",
      "match": true,
      "error": null,
      "latency_ms": 3556.0197830200195,
      "raw_response": "run: ship -> {\n  group_by: ship_name\n  aggregate: \n    midshipman_count is captain.count() { where: captain.rank = 'Midshipman' },\n    lieutenant_count is captain.count() { where: captain.rank = 'Lieutenant' }\n} -> {\n  where: midshipman_count > 0 and lieutenant_count > 0\n  select: ship_name\n}",
      "pred_row_count": 1,
      "gold_row_count": 1
    },
    {
      "question_id": 199,
      "db_id": "geo",
      "question": "what states does the shortest river run through",
      "gold_sql": "SELECT traverse FROM river WHERE LENGTH  =  ( SELECT MIN ( LENGTH ) FROM river );",
      "predicted_malloy": "run: river -> { select: river_name, river_length; order_by: river_length asc; limit: 1 } -> { select: traverses }",
      "predicted_sql": "",
      "match": false,
      "error": "Malloy compile error: error: 'traverses' is not defined at line 1",
      "latency_ms": 2629.643201828003,
      "raw_response": "run: river -> { select: river_name, river_length; order_by: river_length asc; limit: 1 } -> { select: traverses }"
    }
  ]
}